<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GUDANG SMS OK</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4 font-sans text-slate-800">

    <div class="max-w-md mx-auto space-y-4">
        <div class="bg-blue-700 text-white p-5 rounded-2xl shadow-lg text-center border-b-4 border-yellow-500">
            <h1 class="text-xl font-bold uppercase">PT. SAMUDRA MANDIRI SENTOSA</h1>
            <p class="text-[10px] tracking-widest mt-1 text-yellow-300 font-bold underline">SISTEM AKTIF - VERSI FINAL</p>
        </div>

        <div class="bg-white p-5 rounded-2xl shadow border">
            <div class="space-y-4">
                <input type="text" id="Z_NAMA" placeholder="NAMA BARANG" class="w-full p-3 border rounded-xl bg-gray-50 uppercase font-bold outline-none">
                <div class="grid grid-cols-2 gap-3">
                    <input type="number" id="Z_QTY" placeholder="JUMLAH" class="w-full p-3 border rounded-xl bg-gray-50 font-black text-center text-xl">
                    <input type="text" id="Z_KET" placeholder="KET" class="w-full p-3 border rounded-xl bg-gray-50 text-sm">
                </div>
                <div class="grid grid-cols-2 gap-3 pt-2">
                    <button onclick="Z_GAS('masuk')" class="bg-emerald-600 text-white py-4 rounded-xl font-bold shadow-md active:bg-emerald-800 uppercase text-xs">Simpan</button>
                    <button onclick="Z_GAS('keluar')" class="bg-rose-600 text-white py-4 rounded-xl font-bold shadow-md active:bg-rose-800 uppercase text-xs">Keluar</button>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-2xl shadow border overflow-hidden">
            <div class="bg-slate-900 p-2 text-white text-[10px] font-bold uppercase text-center">STOK GUDANG</div>
            <table class="w-full text-sm font-bold">
                <tbody id="Z_TABEL" class="divide-y"></tbody>
            </table>
        </div>

        <div id="Z_LOG" class="p-3 space-y-2 max-h-40 overflow-auto bg-white rounded-xl text-[10px] border shadow-inner"></div>
    </div>

    <script>
        // Konfigurasi Adri
        var firebaseConfig = {
            apiKey: "AIzaSyDbf4nf0iQleiB3R8Un89Gpi1Oio-tTB3o",
            authDomain: "gudang-sms-4c81c.firebaseapp.com",
            databaseURL: "https://gudang-sms-4c81c-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "gudang-sms-4c81c",
            storageBucket: "gudang-sms-4c81c.firebasestorage.app",
            appId: "1:598362736106:web:c8e2732d6ac7613931de93"
        };
        firebase.initializeApp(firebaseConfig);
        var db = firebase.database();

        function Z_GAS(m) {
            var n = document.getElementById('Z_NAMA').value.trim().toLowerCase();
            var q = parseInt(document.getElementById('Z_QTY').value);
            var k = document.getElementById('Z_KET').value || "-";
            var t = new Date().toLocaleTimeString('id-ID');

            if (!n || isNaN(q)) {
                alert("Isi Nama & Jumlah!");
                return;
            }

            var refS = db.ref('stok/' + n);
            var refL = db.ref('riwayat').push();

            refS.once('value').then(function(s) {
                var l = s.exists() ? parseInt(s.val().stok) : 0;
                var b = (m === 'masuk') ? (l + q) : (l - q);
                
                if (b < 0) {
                    alert("Stok Gagal! Minus.");
                    return;
                }

                refS.update({ nama: n, stok: b });
                refL.set({ t: t, m: m, n: n, q: (m==='masuk'?'+':'-')+q, k: k });
                
                alert("BERHASIL!");
                document.getElementById('Z_NAMA').value=''; 
                document.getElementById('Z_QTY').value=''; 
                document.getElementById('Z_KET').value='';
            });
        }

        db.ref('stok').on('value', function(snap) {
            var h = "";
            snap.forEach(function(c) {
                h += "<tr class='border-b'><td class='p-3 capitalize'>" + c.val().nama + "</td><td class='p-3 text-right text-blue-700'>" + c.val().stok + "</td></tr>";
            });
            document.getElementById('Z_TABEL').innerHTML = h;
        });

        db.ref('riwayat').on('value', function(snap) {
            var h = ""; var arr = [];
            snap.forEach(function(c) { arr.push(c.val()); });
            arr.reverse().slice(0, 5).forEach(function(v) {
                h += "<div class='border-b pb-1'>[" + v.t + "] <b>" + v.n + "</b> " + v.q + "</div>";
            });
            document.getElementById('Z_LOG').innerHTML = h;
        });
    </script>
</body>
</html>
