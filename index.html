<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Gudang PT. SMS</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">
    <div class="max-w-md mx-auto space-y-4">
        <div class="bg-white p-6 rounded-xl shadow-md border-t-4 border-blue-600">
            <h1 class="text-xl font-bold text-center text-gray-800">PT. SAMUDRA MANDIRI SENTOSA</h1>
            <p class="text-xs text-center text-gray-500 mb-4">Sistem Inventaris Real-time</p>
            
            <div class="space-y-3">
                <input type="text" id="namaBarang" placeholder="Nama Barang" class="w-full p-2 border rounded-lg">
                <input type="number" id="jumlahInput" placeholder="Jumlah Angka" class="w-full p-2 border rounded-lg">
                <div class="flex gap-2">
                    <button onclick="updateStok('masuk')" class="flex-1 bg-green-600 text-white py-2 rounded-lg font-bold">MASUK (+)</button>
                    <button onclick="updateStok('keluar')" class="flex-1 bg-red-600 text-white py-2 rounded-lg font-bold">KELUAR (-)</button>
                </div>
            </div>
        </div>

        <div class="bg-white p-4 rounded-xl shadow-md">
            <h2 class="font-bold text-gray-700 mb-2">ðŸ“¦ Stok Sekarang</h2>
            <table class="w-full text-sm">
                <tbody id="tabelBody" class="divide-y"></tbody>
            </table>
        </div>

        <div class="bg-white p-4 rounded-xl shadow-md">
            <h2 class="font-bold text-gray-700 mb-2">ðŸ•’ Riwayat Transaksi</h2>
            <table class="w-full text-xs">
                <tbody id="tabelRiwayat" class="divide-y text-gray-500"></tbody>
            </table>
        </div>
    </div>

    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyDbf4nf0iQleiB3R8Un89Gpi1Oio-tTB3o",
        authDomain: "gudang-sms-4c81c.firebaseapp.com",
        databaseURL: "https://gudang-sms-4c81c-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "gudang-sms-4c81c",
        storageBucket: "gudang-sms-4c81c.firebasestorage.app",
        messagingSenderId: "598362736106",
        appId: "1:598362736106:web:c8e2732d6ac7613931de93"
      };

      firebase.initializeApp(firebaseConfig);
      const db = firebase.database();

      function updateStok(tipe) {
        const nama = document.getElementById('namaBarang').value.trim().toLowerCase();
        const jumlah = parseInt(document.getElementById('jumlahInput').value);
        const waktuSkg = new Date().toLocaleString('id-ID');

        if (!nama || isNaN(jumlah)) {
          alert("Isi nama barang dan jumlah angka!");
          return;
        }

        const refStok = db.ref('stok/' + nama);
        const refRiwayat = db.ref('riwayat').push();

        refStok.once('value').then((snap) => {
          let stokLama = snap.exists() ? parseInt(snap.val().stok) : 0;
          let stokBaru = (tipe === 'masuk') ? (stokLama + jumlah) : (stokLama - jumlah);
          
          if (stokBaru < 0) {
            alert("Stok tidak cukup!");
            return;
          }

          // Proses Simpan
          Promise.all([
            refStok.update({ nama: nama, stok: stokBaru, last_update: waktuSkg }),
            refRiwayat.set({ nama: nama, jumlah: (tipe==='masuk'?'+':'-')+jumlah, waktu: waktuSkg, tipe: tipe })
          ]).then(() => {
            document.getElementById('jumlahInput').value = "";
            document.getElementById('namaBarang').value = "";
          }).catch(err => alert("Error: " + err.message));
        });
      }

      db.ref('stok').on('value', (snap) => {
        const data = snap.val();
        let html = "";
        for (let k in data) {
          html += <tr><td class="py-2 capitalize">${data[k].nama}</td><td class="text-right font-bold text-blue-600">${data[k].stok} pcs</td></tr>;
        }
        document.getElementById('tabelBody').innerHTML = html;
      });

      db.ref('riwayat').limitToLast(10).on('value', (snap) => {
        const data = snap.val();
        let html = "";
        const keys = Object.keys(data || {}).reverse();
        keys.forEach(k => {
          const item = data[k];
          const warna = item.tipe === 'masuk' ? 'text-green-600' : 'text-red-600';
          html += <tr><td class="py-1">${item.waktu}</td><td class="text-right capitalize ${warna}">${item.nama} (${item.jumlah})</td></tr>;
        });
        document.getElementById('tabelRiwayat').innerHTML = html;
      });
    </script>
</body>
</html>