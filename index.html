<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistem Gudang</title>

<style>
body{font-family:Arial;background:#f4f6f8;margin:0;padding:10px}
h2,h3{margin:10px 0}
.card{background:#fff;padding:12px;border-radius:10px;margin-bottom:10px}
.dashboard{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
.box{background:#0d6efd;color:#fff;padding:15px;border-radius:10px;text-align:center}
.box span{font-size:22px;font-weight:bold}
input,select,button{width:100%;padding:10px;margin-top:6px;border-radius:6px;border:1px solid #ccc}
button{background:#0d6efd;color:#fff;border:none}
button.danger{background:#dc3545}
button.warn{background:#ffc107;color:#000}
table{width:100%;border-collapse:collapse;font-size:13px}
th,td{border:1px solid #ddd;padding:6px;text-align:center}
th{background:#eee}
.stok-item{display:flex;justify-content:space-between;padding:6px;border-bottom:1px solid #eee}
@media print{
  button,input,select{display:none}
}
</style>
</head>

<body>

<h2>üì¶ Sistem Gudang</h2>

<!-- DASHBOARD -->
<div class="dashboard">
  <div class="box">Total Stok<br><span id="total">0</span></div>
  <div class="box">Jenis Barang<br><span id="jenisBarang">0</span></div>
</div>

<!-- FORM -->
<div class="card">
  <h3>‚ûï Transaksi</h3>
  <input id="barang" placeholder="Nama Barang">
  <select id="jenis">
    <option value="masuk">Masuk</option>
    <option value="keluar">Keluar</option>
  </select>
  <input id="jumlah" type="number" placeholder="Jumlah">
  <input id="editId" type="hidden">
  <button onclick="simpan()">Simpan</button>
</div>

<!-- FILTER -->
<div class="card">
  <h3>üìÖ Filter & Laporan</h3>
  <input type="date" id="tglAwal">
  <input type="date" id="tglAkhir">
  <button onclick="load()">Filter</button>
  <button onclick="exportExcel()">Export Excel</button>
  <button onclick="window.print()">Print</button>
</div>

<!-- STOK PER BARANG -->
<div class="card">
  <h3>üìä Stok per Barang</h3>
  <div id="stokBarang"></div>
</div>

<!-- RIWAYAT -->
<div class="card">
  <h3>üìú Riwayat Transaksi</h3>
  <table>
    <thead>
      <tr>
        <th>Tgl</th>
        <th>Barang</th>
        <th>Jenis</th>
        <th>Jml</th>
        <th>Aksi</th>
      </tr>
    </thead>
    <tbody id="data"></tbody>
  </table>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- EXCEL -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDbf4Nf0J0ELJ3B3R8Un8Ypgi0io-TB30",
  authDomain: "gudang-sms-4c81c.firebaseapp.com",
  databaseURL: "https://gudang-sms-4c81c-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "gudang-sms-4c81c",
  storageBucket: "gudang-sms-4c81c.appspot.com",
  messagingSenderId: "598362736106",
  appId: "1:598362736106:web:c0e2732d6ac7513931de93"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* SIMPAN */
function simpan(){
  const barang=barangEl.value;
  const jenis=jenisEl.value;
  const jumlah=parseInt(jumlahEl.value);
  if(!barang||!jumlah)return alert("Lengkapi data");

  const data={barang,jenis,jumlah,tanggal:new Date().toISOString().slice(0,10)};
  editId.value?db.ref("riwayat/"+editId.value).set(data):db.ref("riwayat").push(data);
  barangEl.value=jumlahEl.value="";editId.value="";
  load();
}

/* LOAD */
function load(){
  const a=tglAwal.value,b=tglAkhir.value;
  db.ref("riwayat").once("value",snap=>{
    let html="",stok={},total=0;
    snap.forEach(x=>{
      const d=x.val(),id=x.key;
      if((!a||d.tanggal>=a)&&(!b||d.tanggal<=b)){
        stok[d.barang]=(stok[d.barang]||0)+(d.jenis=="masuk"?d.jumlah:-d.jumlah);
        total+=d.jenis=="masuk"?d.jumlah:-d.jumlah;
        html+=`<tr>
        <td>${d.tanggal}</td><td>${d.barang}</td><td>${d.jenis}</td><td>${d.jumlah}</td>
        <td>
          <button class="warn" onclick="edit('${id}','${d.barang}','${d.jenis}',${d.jumlah})">‚úèÔ∏è</button>
          <button class="danger" onclick="hapus('${id}')">üóë</button>
        </td></tr>`;
      }
    });
    data.innerHTML=html;
    totalEl.innerText=total;
    jenisBarang.innerText=Object.keys(stok).length;

    stokBarang.innerHTML="";
    for(let b in stok){
      stokBarang.innerHTML+=<div class="stok-item"><span>${b}</span><b>${stok[b]}</b></div>;
    }
  });
}

/* EDIT */
function edit(id,b,j,jml){
  editId.value=id;barangEl.value=b;jenisEl.value=j;jumlahEl.value=jml;
}

/* HAPUS */
function hapus(id){
  if(confirm("Hapus transaksi?"))db.ref("riwayat/"+id).remove().then(load);
}

/* EXPORT EXCEL */
function exportExcel(){
  const rows=[["Tanggal","Barang","Jenis","Jumlah"]];
  document.querySelectorAll("#data tr").forEach(r=>{
    rows.push([...r.children].slice(0,4).map(td=>td.innerText));
  });
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,XLSX.utils.aoa_to_sheet(rows),"Laporan");
  XLSX.writeFile(wb,"laporan_gudang.xlsx");
}

const barangEl=barang,jenisEl=jenis,jumlahEl=jumlah,editId=document.getElementById("editId");
const tglAwal=document.getElementById("tglAwal"),tglAkhir=document.getElementById("tglAkhir");
const totalEl=document.getElementById("total"),jenisBarang=document.getElementById("jenisBarang");
load();
</script>

</body>
</html>
