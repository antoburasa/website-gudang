<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistem Gudang Sederhana</title>

<style>
body{font-family:Arial;margin:0;background:#f4f6f9}
.sidebar{
width:200px;background:#1e3a8a;color:white;
position:fixed;height:100%;padding:20px
}
.sidebar div{margin:10px 0;cursor:pointer}
.content{margin-left:220px;padding:20px}
.card{background:white;padding:15px;border-radius:8px;margin-bottom:15px}
input,select,button{padding:8px;margin-top:5px;width:100%}
table{width:100%;border-collapse:collapse}
th,td{border-bottom:1px solid #eee;padding:8px;text-align:center}
</style>
</head>

<body>

<div class="sidebar">
<h3>GUDANG</h3>
<div onclick="show('dashboard')">Dashboard</div>
<div onclick="show('master')">Master Barang</div>
<div onclick="show('masuk')">Barang Masuk</div>
<div onclick="show('keluar')">Barang Keluar</div>
<div onclick="show('stok')">Stok Barang</div>
<div onclick="show('riwayat')">Riwayat</div>
</div>

<div class="content">

<div id="dashboard" class="card">
<h2>Dashboard</h2>
Total Stok: <b id="totalStok">0</b><br>
Total Barang: <b id="totalBarang">0</b>
</div>

<div id="master" class="card" style="display:none">
<h2>Master Barang</h2>
<input id="namaBarang" placeholder="Nama Barang">
<button onclick="tambahBarang()">Tambah Barang</button>
<div id="listBarang"></div>
</div>

<div id="masuk" class="card" style="display:none">
<h2>Barang Masuk</h2>
<select id="barangMasuk"></select>
<input id="jumlahMasuk" type="number" placeholder="Jumlah">
<button onclick="transaksi('masuk')">Simpan</button>
</div>

<div id="keluar" class="card" style="display:none">
<h2>Barang Keluar</h2>
<select id="barangKeluar"></select>
<input id="jumlahKeluar" type="number" placeholder="Jumlah">
<button onclick="transaksi('keluar')">Simpan</button>
</div>

<div id="stok" class="card" style="display:none">
<h2>Stok Barang</h2>
<div id="stokList"></div>
</div>

<div id="riwayat" class="card" style="display:none">
<h2>Riwayat Transaksi</h2>
<table>
<thead>
<tr>
<th>Tanggal</th>
<th>Barang</th>
<th>Jenis</th>
<th>Jumlah</th>
</tr>
</thead>
<tbody id="riwayatBody"></tbody>
</table>
</div>

</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
const firebaseConfig={
apiKey:"AIzaSyDbf4nf0iQleiB3R8Un89Gpi1Oio-tTB3o",
authDomain:"gudang-sms-4c81c.firebaseapp.com",
databaseURL:"https://gudang-sms-4c81c-default-rtdb.asia-southeast1.firebasedatabase.app",
projectId:"gudang-sms-4c81c"
};

firebase.initializeApp(firebaseConfig);
const db=firebase.database();

function show(id){
["dashboard","master","masuk","keluar","stok","riwayat"]
.forEach(x=>document.getElementById(x).style.display="none");
document.getElementById(id).style.display="block";
}

function tambahBarang(){
const nama=namaBarang.value.toUpperCase();
if(!nama)return;
db.ref("barang/"+nama).set({nama});
namaBarang.value="";
}

function transaksi(jenis){
const select=jenis=="masuk"?barangMasuk:barangKeluar;
const jumlah=jenis=="masuk"?jumlahMasuk:jumlahKeluar;

const data={
barang:select.value,
jumlah:parseInt(jumlah.value),
jenis,
tanggal:new Date().toISOString().slice(0,10)
};

db.ref("riwayat").push(data);
jumlah.value="";
}

function muatBarang(){
db.ref("barang").on("value",snap=>{
let html="";
let opt="";
snap.forEach(c=>{
const b=c.val().nama;
html+=`<div>${b}</div>`;
opt+=`<option value="${b}">${b}</option>`;
});
listBarang.innerHTML=html;
barangMasuk.innerHTML=opt;
barangKeluar.innerHTML=opt;
});
}

function muatData(){
db.ref("riwayat").on("value",snap=>{
let stok={};
let html="";
let total=0;

snap.forEach(c=>{
const d=c.val();
const j=parseInt(d.jumlah);

if(d.jenis=="masuk"){
stok[d.barang]=(stok[d.barang]||0)+j;
total+=j;
}else{
stok[d.barang]=(stok[d.barang]||0)-j;
total-=j;
}

html+=`<tr>
<td>${d.tanggal}</td>
<td>${d.barang}</td>
<td>${d.jenis}</td>
<td>${j}</td>
</tr>`;
});

riwayatBody.innerHTML=html;

let stokHtml="";
for(let b in stok){
stokHtml+=`<div>${b} : <b>${stok[b]}</b></div>`;
}

stokList.innerHTML=stokHtml;
totalStok.innerText=total;
totalBarang.innerText=Object.keys(stok).length;
});
}

window.onload=function(){
muatBarang();
muatData();
};
</script>

</body>
</html>
