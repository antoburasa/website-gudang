<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Stok Barang Sederhana</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body { font-family: Arial; margin: 20px; }
    input, button { margin: 5px; padding: 5px; }
    table { border-collapse: collapse; width: 100%; margin-top: 15px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  </style>
</head>
<body>

<h2>ðŸ“¦ Manajemen Stok Barang</h2>

<h3>Tambah Barang</h3>
<input id="nama" placeholder="Nama Barang">
<input id="stok" type="number" placeholder="Stok Awal">
<button onclick="tambahBarang()">Tambah</button>

<h3>Transaksi</h3>
<input id="idBarang" placeholder="ID Barang">
<input id="jumlah" type="number" placeholder="Jumlah">
<select id="jenis">
  <option value="masuk">Barang Masuk</option>
  <option value="keluar">Barang Keluar</option>
</select>
<button onclick="transaksi()">Proses</button>

<button onclick="exportExcel()">â¬‡ Export Excel</button>

<h3>ðŸ“Š Data Stok</h3>
<table id="tabel">
  <thead>
    <tr>
      <th>ID</th>
      <th>Nama</th>
      <th>Stok</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  // ðŸ”¥ GANTI DENGAN CONFIG FIREBASE KAMU
  const firebaseConfig = {
    apiKey: "API_KEY",
    authDomain: "PROJECT_ID.firebaseapp.com",
    databaseURL: "https://PROJECT_ID-default-rtdb.firebaseio.com",
    projectId: "PROJECT_ID",
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  function tambahBarang() {
    const nama = namaInput.value;
    const stok = parseInt(stokInput.value);
    const id = Date.now();

    db.ref("stok/" + id).set({ nama, stok });
    namaInput.value = "";
    stokInput.value = "";
  }

  function transaksi() {
    const id = idBarang.value;
    const jumlah = parseInt(jumlahInput.value);
    const jenis = jenisSelect.value;

    const ref = db.ref("stok/" + id);
    ref.once("value", snap => {
      if (!snap.exists()) return alert("Barang tidak ditemukan");

      let stok = snap.val().stok;
      stok = jenis === "masuk" ? stok + jumlah : stok - jumlah;

      ref.update({ stok });

      db.ref("transaksi").push({
        barangId: id,
        jumlah,
        jenis,
        waktu: new Date().toLocaleString()
      });
    });
  }

  db.ref("stok").on("value", snap => {
    const tbody = document.querySelector("#tabel tbody");
    tbody.innerHTML = "";
    snap.forEach(item => {
      tbody.innerHTML += `
        <tr>
          <td>${item.key}</td>
          <td>${item.val().nama}</td>
          <td>${item.val().stok}</td>
        </tr>`;
    });
  });

  function exportExcel() {
    db.ref("transaksi").once("value", snap => {
      const data = [];
      snap.forEach(item => data.push(item.val()));

      const ws = XLSX.utils.json_to_sheet(data);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Transaksi");
      XLSX.writeFile(wb, "riwayat_transaksi.xlsx");
    });
  }

  const namaInput = document.getElementById("nama");
  const stokInput = document.getElementById("stok");
  const idBarang = document.getElementById("idBarang");
  const jumlahInput = document.getElementById("jumlah");
  const jenisSelect = document.getElementById("jenis");
</script>

</body>
</html>
