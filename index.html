<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Gudang</title>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://cdn.tailwindcss.com"></script>

</head>
<body class="bg-gray-100">

<header class="bg-blue-800 text-white p-4 text-center font-bold">
INVENTORY MANAGEMENT SYSTEM
</header>

<nav class="flex justify-center gap-3 bg-white shadow p-3 text-sm">
<button onclick="show('master')" class="px-3 py-1 bg-blue-600 text-white rounded">Master</button>
<button onclick="show('masuk')" class="px-3 py-1 bg-green-600 text-white rounded">Masuk</button>
<button onclick="show('keluar')" class="px-3 py-1 bg-red-600 text-white rounded">Keluar</button>
<button onclick="show('stok')" class="px-3 py-1 bg-gray-700 text-white rounded">Stok</button>
<button onclick="show('riwayat')" class="px-3 py-1 bg-purple-600 text-white rounded">Riwayat</button>
</nav>

<div class="max-w-6xl mx-auto p-4">

<!-- MASTER BARANG -->
<section id="master">
<h2 class="font-bold mb-2">Master Barang</h2>
<input id="mNama" placeholder="Nama Barang" class="border p-2 w-full mb-2">
<input id="mSatuan" placeholder="Satuan" class="border p-2 w-full mb-2">
<input id="mMin" type="number" placeholder="Stok Minimum" class="border p-2 w-full mb-2">
<button onclick="tambahMaster()" class="bg-blue-600 text-white px-4 py-2 rounded">Simpan</button>
<ul id="listMaster" class="mt-4 text-sm"></ul>
</section>

<!-- BARANG MASUK -->
<section id="masuk" class="hidden">
<h2 class="font-bold mb-2">Barang Masuk</h2>
<input id="inNama" placeholder="Nama Barang" class="border p-2 w-full mb-2">
<input id="inQty" type="number" placeholder="Jumlah" class="border p-2 w-full mb-2">
<button onclick="barangMasuk()" class="bg-green-600 text-white px-4 py-2 rounded">Simpan</button>
</section>

<!-- BARANG KELUAR -->
<section id="keluar" class="hidden">
<h2 class="font-bold mb-2">Barang Keluar</h2>
<input id="outNama" placeholder="Nama Barang" class="border p-2 w-full mb-2">
<input id="outQty" type="number" placeholder="Jumlah" class="border p-2 w-full mb-2">
<button onclick="barangKeluar()" class="bg-red-600 text-white px-4 py-2 rounded">Kurangi</button>
</section>

<!-- STOK -->
<section id="stok" class="hidden">
<h2 class="font-bold mb-2">Stok Barang</h2>
<table class="w-full text-sm bg-white">
<thead><tr class="bg-gray-200"><th>Nama</th><th>Stok</th></tr></thead>
<tbody id="tabelStok"></tbody>
</table>
</section>

<!-- RIWAYAT -->
<section id="riwayat" class="hidden">
<h2 class="font-bold mb-2">Riwayat Transaksi</h2>
<ul id="listRiwayat" class="text-sm bg-white p-2"></ul>
</section>

</div>

<script>
firebase.initializeApp({
 apiKey:"AIzaSyDbf4nf0iQleiB3R8Un89Gpi1Oio-tTB3o",
 databaseURL:"https://gudang-sms-4c81c-default-rtdb.asia-southeast1.firebasedatabase.app"
});
const db=firebase.database();

function show(id){
document.querySelectorAll("section").forEach(s=>s.classList.add("hidden"));
document.getElementById(id).classList.remove("hidden");
}

function key(n){return n.replace(/\s+/g,'_').toLowerCase();}

function tambahMaster(){
const nama=mNama.value.trim();
if(!nama)return alert("Isi nama");
db.ref("masterBarang/"+key(nama)).set({
nama,
satuan:mSatuan.value||"pcs",
stokMin:parseInt(mMin.value)||0
});
mNama.value=mSatuan.value=mMin.value="";
}

db.ref("masterBarang").on("value",s=>{
let h="";
s.forEach(c=>h+=<li>â€¢ ${c.val().nama}</li>);
listMaster.innerHTML=h;
});

function barangMasuk(){
const nama=inNama.value; const q=+inQty.value;
if(!nama||q<=0)return;
const k=key(nama);
db.ref("stok/"+k).once("value").then(s=>{
const stok=s.exists()?s.val().stok:0;
db.ref("stok/"+k).set({nama,stok:stok+q});
db.ref("transaksi").push({tanggal:new Date().toLocaleString(),jenis:"Masuk",barang:nama,qty:q});
});
}

function barangKeluar(){
const nama=outNama.value; const q=+outQty.value;
const k=key(nama);
db.ref("stok/"+k).once("value").then(s=>{
if(!s.exists()||s.val().stok<q)return alert("Stok kurang");
db.ref("stok/"+k).update({stok:s.val().stok-q});
db.ref("transaksi").push({tanggal:new Date().toLocaleString(),jenis:"Keluar",barang:nama,qty:q});
});
}

db.ref("stok").on("value",s=>{
let h="";
s.forEach(c=>h+=<tr><td>${c.val().nama}</td><td>${c.val().stok}</td></tr>);
tabelStok.innerHTML=h;
});

db.ref("transaksi").on("value",s=>{
let h="";
s.forEach(c=>{
const d=c.val();
h+=<li>${d.tanggal} | ${d.jenis} | ${d.barang} (${d.qty})</li>;
});
listRiwayat.innerHTML=h;
});
</script>

</body>
</html>