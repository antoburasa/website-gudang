<!DOCTYPE html>
<html>
<head>
  <title>GUDANG RAWMATERIAL SMS</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <style>
    body{font-family:Arial;background:#f4f6f8;margin:0}
    .menu{background:#1f2937;color:white;padding:10px}
    .menu button{margin-right:10px}
    .page{display:none;padding:20px}
    table{background:white;border-collapse:collapse}
    th,td{padding:6px;border:1px solid #ccc}
    input,select{padding:4px}
  </style>
</head>
<body>

<div class="menu">
  <button onclick="showPage('dashboard')">Dashboard</button>
  <button onclick="showPage('master')">Master Barang</button>
  <button onclick="showPage('prs')">PRS</button>
</div>

<!-- DASHBOARD -->
<div id="dashboard" class="page">
  <h2>Dashboard Gudang Rawmaterial SMS</h2>
  Sistem siap digunakan.
</div>

<!-- MASTER BARANG -->
<div id="master" class="page">
  <h2>Master Barang</h2>

  <input id="kode" placeholder="Kode">
  <input id="nama" placeholder="Nama">
  <input id="unit" placeholder="Unit">
  <button onclick="simpanMaster()">Simpan</button>

  <br><br>

  <table width="100%">
    <thead>
      <tr>
        <th>Kode</th>
        <th>Nama</th>
        <th>Unit</th>
      </tr>
    </thead>
    <tbody id="masterList"></tbody>
  </table>
</div>

<!-- PRS -->
<div id="prs" class="page">
  <h2>FORM PRS</h2>

  <label>No PRS</label><br>
  <input id="noPrs" readonly><br><br>

  <label>Tanggal</label><br>
  <input type="date" id="prsTanggal"><br><br>

  <label>Charge To</label><br>
  <input id="prsCharge"><br><br>

  <label>User</label><br>
  <input id="prsUser"><br><br>

  <label>Departemen</label><br>
  <input id="prsDept"><br><br>

  <table width="100%">
    <thead>
      <tr>
        <th>Kode Barang</th>
        <th>Nama</th>
        <th>Unit</th>
        <th>Qty</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="prsTable"></tbody>
  </table>

  <br>
  <button onclick="addPrsRow()">+ Tambah Barang</button>
  <button onclick="simpanPRS()">Simpan PRS</button>
</div>

<script>
/* ================= FIREBASE CONFIG ================= */
/* GANTI DENGAN CONFIG FIREBASE KAMU */
var firebaseConfig = {
  apiKey: "APIKEY",
  authDomain: "PROJECT.firebaseapp.com",
  projectId: "PROJECTID"
};

firebase.initializeApp(firebaseConfig);
var db = firebase.firestore();

/* ================= NAVIGATION ================= */
function showPage(id){
  document.querySelectorAll(".page").forEach(p=>p.style.display="none");
  document.getElementById(id).style.display="block";

  if(id==="master") loadMaster();
  if(id==="prs"){
    generatePRS();
    document.getElementById("prsTable").innerHTML="";
    addPrsRow();
  }
}

showPage("dashboard");

/* ================= MASTER BARANG ================= */
function simpanMaster(){
  const kode=document.getElementById("kode").value;
  const nama=document.getElementById("nama").value;
  const unit=document.getElementById("unit").value;

  db.collection("master_barang").doc(kode).set({
    kode,nama,unit
  }).then(()=>{
    alert("Tersimpan");
    loadMaster();
  });
}

async function loadMaster(){
  const tbody=document.getElementById("masterList");
  tbody.innerHTML="";

  const snap=await db.collection("master_barang").get();
  snap.forEach(doc=>{
    const d=doc.data();
    tbody.innerHTML+=`
      <tr>
        <td>${d.kode}</td>
        <td>${d.nama}</td>
        <td>${d.unit}</td>
      </tr>`;
  });
}

/* ================= PRS ================= */
function generatePRS(){
  document.getElementById("noPrs").value="PRS-"+Date.now();
}

async function addPrsRow(){
  const masterSnap=await db.collection("master_barang").get();

  let options="";
  masterSnap.forEach(doc=>{
    const d=doc.data();
    options+=`<option value="${d.kode}|${d.nama}|${d.unit}">
      ${d.kode} - ${d.nama}
    </option>`;
  });

  const tr=document.createElement("tr");
  tr.innerHTML=`
    <td>
      <select onchange="isiBarang(this)">
        <option value="">Pilih</option>
        ${options}
      </select>
    </td>
    <td><input readonly></td>
    <td><input readonly></td>
    <td><input type="number"></td>
    <td><button onclick="this.closest('tr').remove()">Hapus</button></td>
  `;

  document.getElementById("prsTable").appendChild(tr);
}

function isiBarang(select){
  const val=select.value.split("|");
  const row=select.closest("tr");

  row.cells[1].children[0].value=val[1];
  row.cells[2].children[0].value=val[2];
}

async function simpanPRS(){
  const no=document.getElementById("noPrs").value;
  const tanggal=document.getElementById("prsTanggal").value;
  const charge=document.getElementById("prsCharge").value;
  const user=document.getElementById("prsUser").value;
  const dept=document.getElementById("prsDept").value;

  const rows=document.querySelectorAll("#prsTable tr");

  for(const r of rows){
    const kode=r.cells[0].children[0].value.split("|")[0];
    const nama=r.cells[1].children[0].value;
    const unit=r.cells[2].children[0].value;
    const qty=r.cells[3].children[0].value;

    await db.collection("prs").add({
      no,tanggal,charge,user,dept,kode,nama,unit,qty,status:"PRS"
    });
  }

  alert("PRS berhasil disimpan");
  showPage("dashboard");
}
</script>
</body>
</html>
