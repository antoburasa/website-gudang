<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistem Gudang</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
body{margin:0;font-family:Arial;background:#f1f5f9;padding:15px}
h1,h2{margin:5px 0}
.card{background:#fff;padding:15px;border-radius:8px;margin-bottom:15px;box-shadow:0 2px 6px rgba(0,0,0,.05)}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px}
.stat{background:#eff6ff;text-align:center;padding:15px;border-radius:8px}
.stat h3{margin:0;font-size:13px;color:#475569}
.stat p{margin:5px 0 0;font-size:22px;font-weight:bold;color:#1e40af}
.row{display:flex;flex-wrap:wrap;gap:8px}
input,select,button{padding:8px;border-radius:6px;border:1px solid #cbd5e1}
button{background:#2563eb;color:#fff;border:none;cursor:pointer}
button:hover{opacity:.9}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid #e5e7eb;text-align:center}
th{background:#e2e8f0}
.masuk{color:green;font-weight:bold}
.keluar{color:red;font-weight:bold}
.action{cursor:pointer}
@media print{
button,input,select{display:none}
}
</style>
</head>

<body>

<h1>ðŸ“¦ Sistem Gudang</h1>

<div class="card grid">
  <div class="stat"><h3>Jenis Barang</h3><p id="dBarang">0</p></div>
  <div class="stat"><h3>Total Stok</h3><p id="dStok">0</p></div>
  <div class="stat"><h3>Total Masuk</h3><p id="dMasuk">0</p></div>
  <div class="stat"><h3>Total Keluar</h3><p id="dKeluar">0</p></div>
</div>

<div class="card">
<h2>Tambah Barang</h2>
<div class="row">
<input id="bNama" placeholder="Nama Barang">
<input id="bStok" type="number" placeholder="Stok Awal">
<button onclick="tambahBarang()">Simpan</button>
</div>
</div>

<div class="card">
<h2>Transaksi</h2>
<div class="row">
<select id="tBarang"></select>
<select id="tJenis">
<option value="masuk">Masuk</option>
<option value="keluar">Keluar</option>
</select>
<input id="tJumlah" type="number" placeholder="Jumlah">
<button onclick="transaksi()">Proses</button>
</div>
</div>

<div class="card">
<h2>Riwayat</h2>
<div class="row">
<input type="date" id="fMulai">
<input type="date" id="fAkhir">
<button onclick="exportExcel()">Export Excel</button>
<button onclick="window.print()">Print</button>
</div>
<table>
<thead>
<tr>
<th>Tanggal</th><th>Barang</th><th>Jenis</th><th>Jumlah</th><th>Aksi</th>
</tr>
</thead>
<tbody id="riwayat"></tbody>
</table>
</div>

<script>
// ================= FIREBASE =================
const firebaseConfig = {
  apiKey: "ISI_API_KEY",
  authDomain: "PROJECT.firebaseapp.com",
  databaseURL: "https://PROJECT.firebaseio.com",
  projectId: "PROJECT"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ================= BARANG =================
function tambahBarang(){
  const nama=bNama.value.trim();
  const stok=parseInt(bStok.value);
  if(!nama||stok<0)return alert("Data salah");
  db.ref("barang").push({nama,stok});
  bNama.value="";bStok.value="";
}

db.ref("barang").on("value",s=>{
  tBarang.innerHTML="";
  let totalStok=0,count=0;
  s.forEach(c=>{
    count++; totalStok+=c.val().stok;
    tBarang.innerHTML+=<option value="${c.key}">${c.val().nama}</option>;
  });
  dBarang.innerText=count;
  dStok.innerText=totalStok;
});

// ================= TRANSAKSI =================
function transaksi(){
  const id=tBarang.value;
  const jenis=tJenis.value;
  const jumlah=parseInt(tJumlah.value);
  if(jumlah<=0)return alert("Jumlah salah");

  const ref=db.ref("barang/"+id);
  ref.once("value",s=>{
    let stok=s.val().stok;
    if(jenis==="keluar" && stok<jumlah)return alert("Stok kurang");
    stok=jenis==="masuk"?stok+jumlah:stok-jumlah;
    ref.update({stok});

    db.ref("transaksi").push({
      tanggal:new Date().toISOString().slice(0,10),
      barang:s.val().nama,
      jenis,
      jumlah
    });
    tJumlah.value="";
  });
}

// ================= RIWAYAT =================
db.ref("transaksi").on("value",s=>{
  riwayat.innerHTML="";
  let masuk=0,keluar=0;
  s.forEach(c=>{
    const d=c.val();
    if(d.jenis==="masuk")masuk+=d.jumlah;
    else keluar+=d.jumlah;

    riwayat.innerHTML=
    `<tr>
      <td>${d.tanggal}</td>
      <td>${d.barang}</td>
      <td class="${d.jenis}">${d.jenis}</td>
      <td>${d.jumlah}</td>
      <td>
        <span class="action" onclick="hapus('${c.key}')">ðŸ—‘</span>
      </td>
    </tr>` + riwayat.innerHTML;
  });
  dMasuk.innerText=masuk;
  dKeluar.innerText=keluar;
});

function hapus(id){
  if(confirm("Hapus transaksi?")){
    db.ref("transaksi/"+id).remove();
  }
}

// ================= EXPORT =================
function exportExcel(){
  let wb=XLSX.utils.book_new();
  let ws=XLSX.utils.table_to_sheet(document.querySelector("table"));
  XLSX.utils.book_append_sheet(wb,ws,"Riwayat");
  XLSX.writeFile(wb,"riwayat-gudang.xlsx");
}
</script>

</body>
</html>
