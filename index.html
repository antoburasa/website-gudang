<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Gudang SMS - Berfungsi</title>

    <style>
        body{font-family:'Plus Jakarta Sans', sans-serif; background:#f0f2f5; margin:0; padding:15px; color: #1a1f36;}
        h2{text-align:center; color:#1e40af; font-weight:800; text-transform:uppercase; letter-spacing:1px; margin-bottom:20px}
        h3{margin:0 0 15px 0; font-size:16px; color:#475569; border-left:4px solid #0d6efd; padding-left:10px}
        
        .card{background:#fff; padding:20px; border-radius:16px; margin-bottom:15px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); border: 1px solid #e2e8f0}
        
        .dashboard{display:grid; grid-template-columns:repeat(2,1fr); gap:12px; margin-bottom:15px}
        .box{background: linear-gradient(135deg, #0d6efd, #0b5ed7); color:#fff; padding:20px; border-radius:16px; text-align:center; transition: transform 0.2s}
        .box:hover{transform: translateY(-3px)}
        .box span{font-size:28px; font-weight:800; display:block; margin-top:5px}
        
        input,select,button{width:100%; padding:12px; margin-top:10px; border-radius:10px; border:1px solid #cbd5e1; box-sizing: border-box; font-size:14px; outline:none}
        input:focus{border-color:#0d6efd; box-shadow: 0 0 0 3px rgba(13,110,253,0.1)}
        
        button{background:#0d6efd; color:#fff; border:none; cursor:pointer; font-weight:bold; transition:0.3s; text-transform:uppercase}
        button:hover{background:#0b5ed7; box-shadow: 0 4px 12px rgba(13,110,253,0.3)}
        
        button.danger{background:#ef4444}
        button.warn{background:#f59e0b; color:#fff}
        
        table{width:100%; border-collapse:collapse; font-size:13px; margin-top:10px; background: #fff}
        th,td{padding:12px; text-align:center; border-bottom:1px solid #f1f5f9}
        th{background:#f8fafc; color:#64748b; font-weight:700; text-transform:uppercase; font-size:11px}
        
        .stok-item{display:flex; justify-content:space-between; padding:12px; border-bottom:1px solid #f1f5f9; font-weight:600}
        .stok-item:last-child{border:none}
        .stok-item span{color:#475569}
        .stok-item b{color:#1e40af; font-size:16px}

        @media print{ button,input,select,.no-print{display:none} .card{box-shadow:none; border:1px solid #ddd} }
    </style>
</head>

<body>

<h2>ðŸ“¦ SMS Gudang System</h2>

<div class="dashboard">
  <div class="box">Total Stok Fisik<br><span id="total">0</span></div>
  <div class="box">Jenis Barang<br><span id="jenisBarang">0</span></div>
</div>

<div class="card no-print">
  <h3>âž• Input Transaksi</h3>
  <input id="barang" placeholder="Nama Barang (Contoh: SEMEN)">
  <select id="jenis">
    <option value="masuk">Barang Masuk (+)</option>
    <option value="keluar">Barang Keluar (-)</option>
  </select>
  <input id="jumlah" type="number" placeholder="Jumlah Unit">
  <button type="button" onclick="simpan()">SIMPAN DATA</button>
</div>

<div class="card no-print">
  <h3>ðŸ“… Filter & Laporan</h3>
  <div style="display:flex; gap:10px">
      <input type="date" id="tglAwal">
      <input type="date" id="tglAkhir">
  </div>
  <button type="button" class="warn" onclick="loadData()">Terapkan Filter</button>
  <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px">
    <button type="button" style="background:#10b981" onclick="exportExcel()">Excel</button>
    <button type="button" style="background:#6366f1" onclick="window.print()">Cetak PDF</button>
  </div>
</div>

<div class="card">
  <h3>ðŸ“Š Ringkasan Stok</h3>
  <div id="stokBarang"></div>
</div>

<div class="card">
  <h3>ðŸ“œ Riwayat Transaksi</h3>
  <div style="overflow-x:auto">
      <table>
        <thead>
          <tr>
            <th>Tanggal</th>
            <th>Barang</th>
            <th>Jenis</th>
            <th>Jumlah</th>
            <th class="no-print">Aksi</th>
          </tr>
        </thead>
        <tbody id="data"></tbody>
      </table>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<script>
/* KONFIGURASI FIREBASE - SESUAIKAN DENGAN MILIK ANDA */
var firebaseConfig = {
  apiKey: "AIzaSyDbf4nf0iQleiB3R8Un89Gpi1Oio-tTB3o",
  authDomain: "gudang-sms-4c81c.firebaseapp.com",
  databaseURL: "https://gudang-sms-4c81c-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "gudang-sms-4c81c",
  storageBucket: "gudang-sms-4c81c.appspot.com",
  messagingSenderId: "598362736106",
  appId: "1:598362736106:web:c8e2732d6ac7613931de93"
};

firebase.initializeApp(firebaseConfig);
var db = firebase.database();

function simpan(){
  var bInput = document.getElementById("barang");
  var jInput = document.getElementById("jumlah");
  var jenis = document.getElementById("jenis").value;
  var b = bInput.value.trim().toUpperCase();
  var j = parseInt(jInput.value);

  if(!b || isNaN(j) || j <= 0){
    alert("Lengkapi nama barang & jumlah!");
    return;
  }

  db.ref("riwayat").push({
    barang: b,
    jenis: jenis,
    jumlah: j,
    tanggal: new Date().toISOString().slice(0,10)
  }, function(err){
    if(err) alert("Gagal!");
    else { bInput.value = ""; jInput.value = ""; loadData(); }
  });
}

function loadData(){
  var tglAwal = document.getElementById("tglAwal").value;
  var tglAkhir = document.getElementById("tglAkhir").value;

  db.ref("riwayat").on("value", function(snap){
    var html="", stok={}, total=0;
    snap.forEach(function(child){
      var d = child.val();
      if(tglAwal && d.tanggal < tglAwal) return;
      if(tglAkhir && d.tanggal > tglAkhir) return;

      var perubahan = (d.jenis === "masuk" ? d.jumlah : -d.jumlah);
      stok[d.barang] = (stok[d.barang] || 0) + perubahan;
      total += perubahan;

      html += `<tr>
        <td>${d.tanggal}</td>
        <td><b>${d.barang}</b></td>
        <td style="color:${d.jenis === 'masuk' ? '#10b981' : '#ef4444'}"><b>${d.jenis.toUpperCase()}</b></td>
        <td>${d.jumlah}</td>
        <td class="no-print"><button class="danger" style="padding:5px 10px; width:auto; font-size:10px" onclick="hapus('${child.key}')">HAPUS</button></td>
      </tr>`;
    });

    document.getElementById("data").innerHTML = html || "<tr><td colspan='5'>Kosong</td></tr>";
    document.getElementById("total").innerText = total;
    document.getElementById("jenisBarang").innerText = Object.keys(stok).length;

    var sHtml="";
    for(var x in stok){
      sHtml += <div class="stok-item"><span>${x}</span><b>${stok[x]}</b></div>;
    }
    document.getElementById("stokBarang").innerHTML = sHtml || "Kosong";
  });
}

function hapus(id){
  if(confirm("Hapus data ini?")) db.ref("riwayat/" + id).remove();
}

function exportExcel(){
  var table = document.querySelector("table");
  var wb = XLSX.utils.table_to_book(table);
  XLSX.writeFile(wb, "Laporan_SMS_Gudang.xlsx");
}

loadData();
</script>

</body>
</html
