<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Sistem Gudang</title>
<style>
body{font-family:Arial;background:#f4f6f8;margin:0;padding:20px}
h2{margin-top:0}
.card{background:#fff;padding:15px;border-radius:8px;margin-bottom:15px}
input,select,button{padding:8px;margin:4px 0;width:100%}
button{background:#0d6efd;color:#fff;border:none;border-radius:5px;cursor:pointer}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ddd;padding:8px;text-align:center}
th{background:#f1f1f1}
.dashboard{display:flex;gap:10px}
.box{flex:1;background:#fff;padding:15px;border-radius:8px;text-align:center}
.box h3{margin:0;font-size:14px;color:#555}
.box span{font-size:24px;font-weight:bold}
</style>
</head>

<body>

<h2>Sistem Gudang</h2>

<!-- DASHBOARD -->
<div class="dashboard">
  <div class="box"><h3>Jenis Barang</h3><span id="jmlBarang">0</span></div>
  <div class="box"><h3>Total Stok</h3><span id="totalStok">0</span></div>
  <div class="box"><h3>Masuk</h3><span id="masuk">0</span></div>
  <div class="box"><h3>Keluar</h3><span id="keluar">0</span></div>
</div>

<!-- TAMBAH BARANG -->
<div class="card">
<h3>Tambah Barang</h3>
<input id="namaBarang" placeholder="Nama Barang">
<input id="stokAwal" type="number" placeholder="Stok Awal">
<button onclick="tambahBarang()">Simpan</button>
</div>

<!-- TRANSAKSI -->
<div class="card">
<h3>Transaksi</h3>
<select id="pilihBarang"></select>
<select id="jenis">
  <option value="masuk">Masuk</option>
  <option value="keluar">Keluar</option>
</select>
<input id="jumlah" type="number" placeholder="Jumlah">
<button onclick="transaksi()">Proses</button>
</div>

<!-- RIWAYAT -->
<div class="card">
<h3>Riwayat Transaksi</h3>
<table>
<thead>
<tr>
<th>Tanggal</th><th>Barang</th><th>Jenis</th><th>Jumlah</th>
</tr>
</thead>
<tbody id="riwayat"></tbody>
</table>
</div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, set, push, onValue, update } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "ISI_API_KEY",
  authDomain: "ISI_AUTH_DOMAIN",
  databaseURL: "ISI_DATABASE_URL",
  projectId: "ISI_PROJECT_ID",
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// TAMBAH BARANG
window.tambahBarang = function(){
  const nama = document.getElementById("namaBarang").value;
  const stok = Number(document.getElementById("stokAwal").value);
  if(!nama || stok<=0) return alert("Isi data");

  set(ref(db,"barang/"+nama),{
    nama:nama,
    stok:stok
  });

  document.getElementById("namaBarang").value="";
  document.getElementById("stokAwal").value="";
}

// LOAD BARANG
onValue(ref(db,"barang"),snap=>{
  let total=0,count=0;
  let opt="";
  snap.forEach(x=>{
    count++;
    total+=x.val().stok;
    opt+=<option value="${x.key}">${x.key}</option>;
  });
  document.getElementById("jmlBarang").innerText=count;
  document.getElementById("totalStok").innerText=total;
  document.getElementById("pilihBarang").innerHTML=opt;
});

// TRANSAKSI
window.transaksi = function(){
  const barang = pilihBarang.value;
  const jenis = document.getElementById("jenis").value;
  const jumlah = Number(document.getElementById("jumlah").value);
  if(jumlah<=0) return alert("Jumlah salah");

  const stokRef = ref(db,"barang/"+barang);
  onValue(stokRef,s=>{
    let stok = s.val().stok;
    if(jenis=="keluar" && stok<jumlah) return alert("Stok kurang");
    stok = jenis=="masuk"? stok+jumlah : stok-jumlah;
    update(stokRef,{stok:stok});
  },{once:true});

  push(ref(db,"riwayat"),{
    barang:barang,
    jenis:jenis,
    jumlah:jumlah,
    tanggal:new Date().toLocaleString()
  });

  document.getElementById("jumlah").value="";
}

// RIWAYAT
onValue(ref(db,"riwayat"),snap=>{
  let html="",m=0,k=0;
  snap.forEach(x=>{
    const d=x.val();
    if(d.jenis=="masuk")m+=d.jumlah; else k+=d.jumlah;
    html+=<tr><td>${d.tanggal}</td><td>${d.barang}</td><td>${d.jenis}</td><td>${d.jumlah}</td></tr>;
  });
  document.getElementById("riwayat").innerHTML=html;
  document.getElementById("masuk").innerText=m;
  document.getElementById("keluar").innerText=k;
});
</script>

</body>
</html>
