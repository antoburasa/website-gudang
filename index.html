<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Gudang PT. SMS</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-5">
    <div class="max-w-md mx-auto bg-white p-6 rounded-lg shadow-lg">
        <h1 class="text-xl font-bold mb-4 text-center">Gudang PT. SAMUDRA MANDIRI SENTOSA</h1>
        
        <div class="space-y-3 mb-6">
            <input type="text" id="namaBarang" placeholder="Nama Barang" class="w-full p-2 border rounded">
            <input type="number" id="jumlahInput" placeholder="Jumlah (Angka)" class="w-full p-2 border rounded">
            <div class="flex gap-2">
                <button onclick="updateStok('masuk')" class="flex-1 bg-blue-600 text-white p-2 rounded font-bold">MASUK (+)</button>
                <button onclick="updateStok('keluar')" class="flex-1 bg-red-600 text-white p-2 rounded font-bold">KELUAR (-)</button>
            </div>
        </div>

        <table class="w-full border-collapse border border-gray-300">
            <thead>
                <tr class="bg-gray-200">
                    <th class="border p-2 text-left">Nama Barang</th>
                    <th class="border p-2 text-center">Stok</th>
                </tr>
            </thead>
            <tbody id="tabelBody"></tbody>
        </table>
    </div>

    <script>
      // Konfigurasi dari proyek gudang-sms-4c81c Anda
      const firebaseConfig = {
        apiKey: "AIzaSyDbf4nf0iQleiB3R8Un89Gpi1Oio-tTB3o",
        authDomain: "gudang-sms-4c81c.firebaseapp.com",
        databaseURL: "https://gudang-sms-4c81c-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "gudang-sms-4c81c",
        storageBucket: "gudang-sms-4c81c.firebasestorage.app",
        messagingSenderId: "598362736106",
        appId: "1:598362736106:web:c8e2732d6ac7613931de93"
      };

      firebase.initializeApp(firebaseConfig);
      const db = firebase.database();

      // Fungsi Update Stok (Bisa Tambah atau Kurang)
      function updateStok(tipe) {
        const nama = document.getElementById('namaBarang').value.toLowerCase();
        const jumlah = parseInt(document.getElementById('jumlahInput').value);

        if (nama && jumlah) {
          const ref = db.ref('stok/' + nama);
          ref.once('value').then((snap) => {
            let stokLama = snap.exists() ? parseInt(snap.val().stok) : 0;
            let stokBaru = (tipe === 'masuk') ? (stokLama + jumlah) : (stokLama - jumlah);
            
            // Stok tidak boleh minus
            if (stokBaru < 0) {
                alert("Stok tidak mencukupi untuk pengeluaran!");
                return;
            }

            ref.set({
              nama: nama,
              stok: stokBaru,
              lastUpdate: new Date().toLocaleString()
            }).then(() => {
              alert("Data " + nama + " berhasil diperbarui!");
              document.getElementById('jumlahInput').value = "";
            });
          });
        }
      }

      // Tampilkan Data Real-time ke Tabel
      db.ref('stok').on('value', (snapshot) => {
        const data = snapshot.val();
        const tbody = document.getElementById('tabelBody');
        tbody.innerHTML = "";
        for (let key in data) {
          tbody.innerHTML += `
            <tr>
              <td class="border p-2 capitalize">${data[key].nama}</td>
              <td class="border p-2 text-center font-bold text-blue-700">${data[key].stok}</td>
            </tr>`;
        }
      });
    </script>
</body>
</html>