<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Gudang PT. SMS</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">
    <div class="max-w-md mx-auto space-y-4">
        <div class="bg-white p-6 rounded-xl shadow-md border-t-4 border-blue-600">
            <h1 class="text-xl font-bold text-center text-gray-800">PT. SAMUDRA MANDIRI SENTOSA</h1>
            <p class="text-xs text-center text-gray-500 mb-4">Sistem Inventaris Real-time</p>
            
            <div class="space-y-3">
                <input type="text" id="namaBarang" placeholder="Nama Barang (Sapu, Cat, dll)" class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-400">
                <input type="number" id="jumlahInput" placeholder="Jumlah Angka" class="w-full p-2 border rounded-lg">
                <div class="flex gap-2">
                    <button onclick="updateStok('masuk')" class="flex-1 bg-green-600 text-white py-2 rounded-lg font-bold hover:bg-green-700">MASUK (+)</button>
                    <button onclick="updateStok('keluar')" class="flex-1 bg-red-600 text-white py-2 rounded-lg font-bold hover:bg-red-700">KELUAR (-)</button>
                </div>
            </div>
        </div>

        <div class="bg-white p-4 rounded-xl shadow-md">
            <h2 class="font-bold text-gray-700 mb-2 flex items-center gap-2">ðŸ“¦ Stok Barang Sekarang</h2>
            <table class="w-full text-sm">
                <thead><tr class="border-b-2"><th class="text-left py-2">Barang</th><th class="text-center py-2">Jumlah</th></tr></thead>
                <tbody id="tabelBody" class="divide-y text-gray-600"></tbody>
            </table>
        </div>

        <div class="bg-white p-4 rounded-xl shadow-md">
            <h2 class="font-bold text-gray-700 mb-2 flex items-center gap-2">ðŸ•’ Riwayat Transaksi Terakhir</h2>
            <table class="w-full text-xs">
                <thead><tr class="border-b-2 text-gray-400"><th class="text-left py-2">Waktu</th><th class="text-left py-2">Info</th></tr></thead>
                <tbody id="tabelRiwayat" class="divide-y text-gray-500"></tbody>
            </table>
        </div>
    </div>

    <script>
      // Konfigurasi Cloud Firebase Anda (Dari Foto 39)
      const firebaseConfig = {
        apiKey: "AIzaSyDbf4nf0iQleiB3R8Un89Gpi1Oio-tTB3o",
        authDomain: "gudang-sms-4c81c.firebaseapp.com",
        databaseURL: "https://gudang-sms-4c81c-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "gudang-sms-4c81c",
        storageBucket: "gudang-sms-4c81c.firebasestorage.app",
        messagingSenderId: "598362736106",
        appId: "1:598362736106:web:c8e2732d6ac7613931de93"
      };

      firebase.initializeApp(firebaseConfig);
      const db = firebase.database();

      function updateStok(tipe) {
        const nama = document.getElementById('namaBarang').value.trim().toLowerCase();
        const jumlah = parseInt(document.getElementById('jumlahInput').value);
        const waktuSkg = new Date().toLocaleString('id-ID');

        if (nama && jumlah) {
          const refStok = db.ref('stok/' + nama);
          const refRiwayat = db.ref('riwayat').push(); // Menyimpan riwayat baru
          
          refStok.once('value').then((snap) => {
            let stokLama = snap.exists() ? parseInt(snap.val().stok) : 0;
            let stokBaru = (tipe === 'masuk') ? (stokLama + jumlah) : (stokLama - jumlah);
            
            if (stokBaru < 0) {
                alert("Gagal! Stok tidak cukup.");
                return;
            }

            // 1. Update Stok Utama
            refStok.set({ nama: nama, stok: stokBaru, last_update: waktuSkg });

            // 2. Simpan ke Riwayat
            refRiwayat.set({
              nama: nama,
              jumlah: (tipe === 'masuk' ? '+' : '-') + jumlah,
              waktu: waktuSkg,
              tipe: tipe
            }).then(() => {
              alert("Data Berhasil di-Update!");
              document.getElementById('jumlahInput').value = "";
              document.getElementById('namaBarang').value = "";
            });
          });
        }
      }

      // Tampilan Tabel Stok Real-time
      db.ref('stok').on('value', (snapshot) => {
        const data = snapshot.val();
        const tbody = document.getElementById('tabelBody');
        tbody.innerHTML = "";
        for (let key in data) {
          tbody.innerHTML += <tr><td class="py-2 capitalize font-medium">${data[key].nama}</td><td class="py-2 text-center font-bold text-blue-600">${data[key].stok} pcs</td></tr>;
        }
      });

      // Tampilan Tabel Riwayat (Sinkron antar HP & Laptop)
      db.ref('riwayat').limitToLast(10).on('value', (snapshot) => {
        const data = snapshot.val();
        const tbody = document.getElementById('tabelRiwayat');
        tbody.innerHTML = "";
        const keys = Object.keys(data || {}).reverse(); // Supaya yang terbaru ada di atas
        keys.forEach(key => {
          const item = data[key];
          const warna = item.tipe === 'masuk' ? 'text-green-600' : 'text-red-600';
          tbody.innerHTML += <tr><td class="py-2">${item.waktu}</td><td class="py-2 capitalize ${warna}">${item.nama} (${item.jumlah})</td></tr>;
        });
      });
    </script>
</body>
</html>