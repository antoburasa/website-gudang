<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gudang SMS</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">
    <div class="max-w-md mx-auto space-y-4">
        <div class="bg-white p-6 rounded-xl shadow-md border-t-4 border-blue-600">
            <h1 class="text-xl font-bold text-center text-gray-800 uppercase">PT. SAMUDRA MANDIRI SENTOSA</h1>
            <p class="text-xs text-center text-gray-500 mb-4 font-bold">SISTEM GUDANG REAL-TIME</p>
            
            <div class="space-y-3">
                <input type="text" id="namaBarang" placeholder="Ketik Nama Barang..." class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <input type="number" id="jumlahInput" placeholder="Jumlah (Angka)" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <div class="flex gap-2">
                    <button onclick="prosesStok('masuk')" class="flex-1 bg-green-600 text-white py-3 rounded-lg font-bold shadow-sm active:scale-95">MASUK (+)</button>
                    <button onclick="prosesStok('keluar')" class="flex-1 bg-red-600 text-white py-3 rounded-lg font-bold shadow-sm active:scale-95">KELUAR (-)</button>
                </div>
            </div>
        </div>

        <div class="bg-white p-4 rounded-xl shadow-md">
            <h2 class="font-bold text-gray-700 mb-2 border-b pb-1">ðŸ“¦ Stok Saat Ini</h2>
            <table class="w-full text-sm">
                <tbody id="tabelBody" class="divide-y"></tbody>
            </table>
        </div>

        <div class="bg-white p-4 rounded-xl shadow-md">
            <h2 class="font-bold text-gray-700 mb-2 border-b pb-1">ðŸ•’ Riwayat Transaksi</h2>
            <table class="w-full text-[10px]">
                <tbody id="tabelRiwayat" class="divide-y text-gray-500"></tbody>
            </table>
        </div>
    </div>

    <script>
        // Konfigurasi Firebase dari Foto 39
        const firebaseConfig = {
            apiKey: "AIzaSyDbf4nf0iQleiB3R8Un89Gpi1Oio-tTB3o",
            authDomain: "gudang-sms-4c81c.firebaseapp.com",
            databaseURL: "https://gudang-sms-4c81c-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "gudang-sms-4c81c",
            storageBucket: "gudang-sms-4c81c.firebasestorage.app",
            messagingSenderId: "598362736106",
            appId: "1:598362736106:web:c8e2732d6ac7613931de93"
        };

        // Inisialisasi
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // FUNGSI UTAMA
        function prosesStok(tipe) {
            const nama = document.getElementById('namaBarang').value.trim().toLowerCase();
            const jumlah = parseInt(document.getElementById('jumlahInput').value);
            const waktuSkg = new Date().toLocaleString('id-ID');

            if (!nama || isNaN(jumlah)) {
                alert("Mohon isi Nama Barang dan Jumlah Angka!");
                return;
            }

            const refStok = db.ref('stok/' + nama);
            const refRiwayat = db.ref('riwayat').push();

            refStok.once('value').then((snap) => {
                let stokLama = 0;
                if (snap.exists()) {
                    stokLama = parseInt(snap.val().stok) || 0;
                }

                let stokBaru = (tipe === 'masuk') ? (stokLama + jumlah) : (stokLama - jumlah);

                if (stokBaru < 0) {
                    alert("Stok tidak mencukupi untuk pengeluaran!");
                    return;
                }

                // Simpan ke Database
                refStok.update({
                    nama: nama,
                    stok: stokBaru,
                    last_update: waktuSkg
                });

                refRiwayat.set({
                    nama: nama,
                    jumlah: (tipe === 'masuk' ? '+' : '-') + jumlah,
                    waktu: waktuSkg,
                    tipe: tipe
                });

                // Reset Form
                document.getElementById('namaBarang').value = "";
                document.getElementById('jumlahInput').value = "";
                alert("Berhasil mencatat barang " + tipe + "!");
                
            }).catch((error) => {
                alert("Terjadi kesalahan: " + error.message);
            });
        }

        // TAMPILAN TABEL STOK (Otomatis)
        db.ref('stok').on('value', (snap) => {
            const data = snap.val();
            let html = "";
            for (let k in data) {
                html += <tr><td class="py-2 capitalize font-medium">${data[k].nama}</td><td class="text-right font-bold text-blue-600">${data[k].stok} pcs</td></tr>;
            }
            document.getElementById('tabelBody').innerHTML = html;
        });

        // TAMPILAN TABEL RIWAYAT (Otomatis)
        db.ref('riwayat').limitToLast(8).on('value', (snap) => {
            const data = snap.val();
            let html = "";
            const keys = Object.keys(data || {}).reverse();
            keys.forEach(k => {
                const item = data[k];
                const warna = item.tipe === 'masuk' ? 'text-green-600' : 'text-red-600';
                html += <tr><td class="py-1">${item.waktu}</td><td class="text-right capitalize ${warna}">${item.nama} (${item.jumlah})</td></tr>;
            });
            document.getElementById('tabelRiwayat').innerHTML = html;
        });
    </script>
</body>
</html>