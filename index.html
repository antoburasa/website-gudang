<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Gudang RawMaterial SMS</title>

<style>
body{font-family:Arial;margin:20px;background:#f4f6f8}
.card{background:white;padding:15px;margin-bottom:15px;border-radius:8px}
table{border-collapse:collapse;width:100%}
th,td{border:1px solid #ccc;padding:6px}
button{padding:6px 10px;margin:3px}
input,select{padding:5px;margin:3px}
</style>
</head>

<body>

<h2>Gudang RawMaterial SMS</h2>

<div class="card">
<h3>Dashboard Stok</h3>
<div id="stok"></div>
</div>

<div class="card">
<h3>Buat PRS</h3>

Nomor PRS:
<input id="prsno" readonly>

Divisi:
<input id="divisi">

<table id="tbl">
<tr>
<th>Barang</th>
<th>UOM</th>
<th>Qty</th>
<th>Status</th>
</tr>
</table>

<button onclick="addRow()">Tambah Item</button>
<br><br>
<button onclick="simpanPRS()">Simpan PRS</button>
<button onclick="window.print()">Print</button>
</div>

<div class="card">
<h3>List PRS</h3>
<div id="list"></div>
</div>

<script>
let masterBarang=[
{kode:"BRG001",nama:"Cat Putih",uom:"Can",stok:10},
{kode:"BRG002",nama:"Thinner",uom:"Can",stok:5},
{kode:"BRG003",nama:"Kuas 3",uom:"Pcs",stok:20}
]

function autoPRS(){
let n=localStorage.getItem("prs_counter")||1
document.getElementById("prsno").value="PRS"+String(n).padStart(4,"0")
}
autoPRS()

function nextPRS(){
let n=parseInt(localStorage.getItem("prs_counter")||1)
n++
localStorage.setItem("prs_counter",n)
autoPRS()
}

function addRow(){
let t=document.getElementById("tbl")
let r=t.insertRow()

let c1=r.insertCell()
let c2=r.insertCell()
let c3=r.insertCell()
let c4=r.insertCell()

let sel=document.createElement("select")
masterBarang.forEach(b=>{
let o=document.createElement("option")
o.value=b.kode
o.text=b.nama
sel.appendChild(o)
})

sel.onchange=function(){
let b=masterBarang.find(x=>x.kode==sel.value)
c2.innerHTML=b.uom
}

c1.appendChild(sel)
c2.innerHTML=masterBarang[0].uom
c3.innerHTML="<input type='number' value='1'>"
c4.innerHTML="<select><option>Pending</option><option>Diproses</option><option>Selesai</option></select>"
}

addRow()

function simpanPRS(){
let data=JSON.parse(localStorage.getItem("prs")||"[]")
let prsno=document.getElementById("prsno").value
let divisi=document.getElementById("divisi").value

let rows=document.getElementById("tbl").rows

for(let i=1;i<rows.length;i++){
let barang=rows[i].cells[0].children[0]
let qty=rows[i].cells[2].children[0].value
let status=rows[i].cells[3].children[0].value
let b=masterBarang.find(x=>x.kode==barang.value)

data.push({
prs:prsno,
divisi:divisi,
barang:b.nama,
kode:b.kode,
uom:b.uom,
qty:qty,
status:status
})
}

localStorage.setItem("prs",JSON.stringify(data))
nextPRS()
renderList()
renderStok()
alert("PRS disimpan")
}

function renderList(){
let data=JSON.parse(localStorage.getItem("prs")||"[]")
let html="<table><tr><th>PRS</th><th>Barang</th><th>Qty</th><th>Status</th></tr>"
data.forEach(d=>{
html+=`<tr onclick='detail("${d.prs}")'>
<td>${d.prs}</td>
<td>${d.barang}</td>
<td>${d.qty}</td>
<td>${d.status}</td>
</tr>`
})
html+="</table>"
document.getElementById("list").innerHTML=html
}
renderList()

function detail(no){
let data=JSON.parse(localStorage.getItem("prs")||"[]")
let f=data.filter(x=>x.prs==no)
alert("DETAIL PRS "+no+"\n\n"+JSON.stringify(f,null,2))
}

function renderStok(){
let html=""
masterBarang.forEach(b=>{
html+=b.nama+" : "+b.stok+"<br>"
})
document.getElementById("stok").innerHTML=html
}
renderStok()
</script>

</body>
</html>
