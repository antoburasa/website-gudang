<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Gudang</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:Arial;margin:20px;background:#f4f6f8}
h2{margin-top:0}
.card{background:#fff;padding:15px;border-radius:8px;margin-bottom:15px}
input,select,button{padding:8px;margin:5px 0;width:100%}
button{cursor:pointer;border:none;border-radius:5px}
.btn{background:#2563eb;color:#fff}
.btn-danger{background:#dc2626;color:#fff}
.btn-warning{background:#f59e0b;color:#fff}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ddd;padding:6px;text-align:center}
th{background:#2563eb;color:#fff}
.flex{display:flex;gap:10px;flex-wrap:wrap}
.small{font-size:13px;color:#555}
</style>
</head>

<body>

<h2>ðŸ“¦ Dashboard Gudang</h2>

<div class="flex">
  <div class="card" style="flex:1">
    <h3>Tambah Transaksi</h3>
    <input id="barang" placeholder="Nama Barang">
    <select id="jenis">
      <option value="masuk">Barang Masuk</option>
      <option value="keluar">Barang Keluar</option>
    </select>
    <input id="jumlah" type="number" placeholder="Jumlah">
    <button class="btn" onclick="tambah()">Simpan</button>
  </div>

  <div class="card" style="flex:1">
    <h3>Ringkasan</h3>
    <p>Masuk: <b id="masuk">0</b></p>
    <p>Keluar: <b id="keluar">0</b></p>
    <input type="date" id="filter">
    <button class="btn-warning" onclick="load()">Filter</button>
    <button class="btn" onclick="exportExcel()">Export Excel</button>
    <button class="btn" onclick="window.print()">Print</button>
  </div>
</div>

<div class="card">
<h3>Riwayat Transaksi</h3>
<table>
<thead>
<tr>
<th>Tanggal</th>
<th>Barang</th>
<th>Jenis</th>
<th>Jumlah</th>
<th>Aksi</th>
</tr>
</thead>
<tbody id="riwayat"></tbody>
</table>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* ================= FIREBASE CONFIG ================= */
const firebaseConfig = {
  apiKey: "API_KEY_KAMU",
  authDomain: "PROJECT.firebaseapp.com",
  databaseURL: "https://PROJECT.asia-southeast1.firebasedatabase.app",
  projectId: "PROJECT",
  storageBucket: "PROJECT.appspot.com",
  messagingSenderId: "SENDER_ID",
  appId: "APP_ID"
};
/* =================================================== */

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* TAMBAH DATA */
function tambah(){
  const barang = document.getElementById("barang").value;
  const jenis = document.getElementById("jenis").value;
  const jumlah = Number(document.getElementById("jumlah").value);

  if(!barang || !jumlah) return alert("Lengkapi data");

  firebase.database().ref("riwayat").push({
    barang, jenis, jumlah,
    tanggal: new Date().toISOString().slice(0,10)
  });

  document.getElementById("barang").value="";
  document.getElementById("jumlah").value="";
}

/* LOAD DATA */
function load(){
  const filter = document.getElementById("filter").value;
  firebase.database().ref("riwayat").on("value",snap=>{
    let html="", masuk=0, keluar=0;
    snap.forEach(x=>{
      const d=x.val();
      if(filter && d.tanggal!==filter) return;

      if(d.jenis==="masuk") masuk+=d.jumlah;
      else keluar+=d.jumlah;

      html+=`
      <tr>
        <td>${d.tanggal}</td>
        <td>${d.barang}</td>
        <td>${d.jenis}</td>
        <td>${d.jumlah}</td>
        <td>
          <button class="btn-warning" onclick="edit('${x.key}')">Edit</button>
          <button class="btn-danger" onclick="hapus('${x.key}')">Hapus</button>
        </td>
      </tr>`;
    });
    document.getElementById("riwayat").innerHTML=html;
    document.getElementById("masuk").innerText=masuk;
    document.getElementById("keluar").innerText=keluar;
  });
}

/* EDIT */
function edit(id){
  const barang=prompt("Nama Barang:");
  const jumlah=prompt("Jumlah:");
  if(!barang||!jumlah) return;
  firebase.database().ref("riwayat/"+id).update({
    barang,
    jumlah:Number(jumlah)
  });
}

/* HAPUS */
function hapus(id){
  if(confirm("Hapus data?"))
    firebase.database().ref("riwayat/"+id).remove();
}

/* EXPORT EXCEL */
function exportExcel(){
  let csv="Tanggal,Barang,Jenis,Jumlah\n";
  document.querySelectorAll("#riwayat tr").forEach(r=>{
    let row=[];
    r.querySelectorAll("td").forEach((c,i)=>{
      if(i<4) row.push(c.innerText);
    });
    csv+=row.join(",")+"\n";
  });
  const blob=new Blob([csv],{type:"text/csv"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="riwayat-gudang.csv";
  a.click();
}

load();
</script>

</body>
</html>
