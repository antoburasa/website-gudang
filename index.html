<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SMS Gudang â€“ FIX</title>

<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;700&display=swap" rel="stylesheet">

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
body{margin:0;font-family:'Plus Jakarta Sans',sans-serif;background:#f4f6f8}
header{background:#1e40af;color:#fff;padding:15px;text-align:center}
nav{display:flex;background:#fff}
nav button{flex:1;padding:12px;border:none;background:#fff;font-weight:700}
nav button.active{background:#1e40af;color:#fff}
.card{background:#fff;margin:15px;padding:15px;border-radius:10px}
input,button{width:100%;padding:10px;margin-top:8px}
button{background:#1e40af;color:#fff;border:none;border-radius:6px}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ddd;padding:8px;text-align:center}
.hide{display:none}
</style>
</head>

<body>

<header>ðŸ“¦ SMS GUDANG</header>

<nav>
<button onclick="show('dash')" class="active">Dashboard</button>
<button onclick="show('masuk')">Masuk</button>
<button onclick="show('keluar')">Keluar</button>
<button onclick="show('riwayat')">Riwayat</button>
</nav>

<div id="dash" class="card">
<p>Total Stok: <b id="totalStok">0</b></p>
<p>Jenis Barang: <b id="totalJenis">0</b></p>
<div id="stokList"></div>
</div>

<div id="masuk" class="card hide">
<h3>Barang Masuk</h3>
<input id="in_barang" placeholder="Nama Barang">
<input id="in_jumlah" type="number" placeholder="Jumlah">
<button onclick="simpan('masuk')">Simpan</button>
</div>

<div id="keluar" class="card hide">
<h3>Barang Keluar</h3>
<input id="out_barang" placeholder="Nama Barang">
<input id="out_jumlah" type="number" placeholder="Jumlah">
<button onclick="simpan('keluar')">Kurangi</button>
</div>

<div id="riwayat" class="card hide">
<h3>Riwayat</h3>
<button onclick="exportExcel()">Export Excel</button>
<table id="tbl">
<thead>
<tr><th>Tanggal</th><th>Barang</th><th>Jenis</th><th>Qty</th><th>Aksi</th></tr>
</thead>
<tbody id="riwayatBody"></tbody>
</table>
</div>

<script>
const firebaseConfig = {
  apiKey: "GANTI_APIKEY",
  authDomain: "GANTI_AUTHDOMAIN",
  databaseURL: "GANTI_DATABASEURL",
  projectId: "GANTI_PROJECTID",
  storageBucket: "GANTI_BUCKET",
  appId: "GANTI_APPID"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

function show(id){
  document.querySelectorAll('.card').forEach(c=>c.classList.add('hide'));
  document.getElementById(id).classList.remove('hide');
  document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
  event.target.classList.add('active');
}

function simpan(tipe){
  const barang = (tipe==='masuk'?in_barang:out_barang).value.trim().toUpperCase();
  const jumlah = parseInt(tipe==='masuk'?in_jumlah.value:out_jumlah.value);
  if(!barang || !jumlah) return alert("Lengkapi data");

  const ref = db.ref("barang/"+barang);
  ref.once("value",s=>{
    let stok = s.exists()?s.val():0;
    if(tipe==='keluar' && stok<jumlah) return alert("Stok kurang");

    ref.set(tipe==='masuk'?stok+jumlah:stok-jumlah);
    db.ref("riwayat").push({
      barang, jumlah, jenis:tipe, tanggal:new Date().toLocaleString()
    });
    document.querySelectorAll('input').forEach(i=>i.value="");
  });
}

db.ref("barang").on("value",s=>{
  let total=0,jenis=0,html="";
  s.forEach(c=>{
    total+=c.val(); jenis++;
    html+=<div>${c.key}: ${c.val()}</div>;
  });
  totalStok.innerText=total;
  totalJenis.innerText=jenis;
  stokList.innerHTML=html;
});

let excel=[];
db.ref("riwayat").on("value",s=>{
  let html="";
  excel=[];
  s.forEach(c=>{
    const d=c.val(); excel.push(d);
    html+=`<tr>
      <td>${d.tanggal}</td>
      <td>${d.barang}</td>
      <td>${d.jenis}</td>
      <td>${d.jumlah}</td>
      <td><button onclick="db.ref('riwayat/${c.key}').remove()">Hapus</button></td>
    </tr>`;
  });
  riwayatBody.innerHTML=html;
});

function exportExcel(){
  const ws=XLSX.utils.json_to_sheet(excel);
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,"Riwayat");
  XLSX.writeFile(wb,"gudang.xlsx");
}
</script>

</body>
</html>
