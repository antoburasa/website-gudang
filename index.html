<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gudang SMS</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-200 p-4">
    <div class="max-w-md mx-auto bg-white p-6 rounded-xl shadow-lg">
        <h1 class="text-center font-bold text-blue-700 mb-4">PT. SAMUDRA MANDIRI SENTOSA</h1>
        
        <div class="space-y-3 mb-6">
            <input type="text" id="nama" placeholder="Nama Barang" class="w-full p-2 border rounded">
            <input type="number" id="jumlah" placeholder="Jumlah" class="w-full p-2 border rounded">
            <div class="flex gap-2">
                <button onclick="aksi('masuk')" class="flex-1 bg-green-600 text-white py-2 rounded font-bold">MASUK (+)</button>
                <button onclick="aksi('keluar')" class="flex-1 bg-red-600 text-white py-2 rounded font-bold">KELUAR (-)</button>
            </div>
        </div>

        <h2 class="font-bold border-b mb-2">ðŸ“¦ Stok Sekarang</h2>
        <div id="tabelStok" class="text-sm mb-6"></div>

        <h2 class="font-bold border-b mb-2">ðŸ•’ Riwayat</h2>
        <div id="tabelRiwayat" class="text-[10px] text-gray-500"></div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDbf4nf0iQleiB3R8Un89Gpi1Oio-tTB3o",
            authDomain: "gudang-sms-4c81c.firebaseapp.com",
            databaseURL: "https://gudang-sms-4c81c-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "gudang-sms-4c81c",
            storageBucket: "gudang-sms-4c81c.firebasestorage.app",
            messagingSenderId: "598362736106",
            appId: "1:598362736106:web:c8e2732d6ac7613931de93"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function aksi(tipe) {
            const n = document.getElementById('nama').value.trim().toLowerCase();
            const j = parseInt(document.getElementById('jumlah').value);
            const w = new Date().toLocaleString('id-ID');

            if(!n || isNaN(j)) return alert("Isi data dulu!");

            const sRef = db.ref('stok/' + n);
            const rRef = db.ref('riwayat').push();

            sRef.once('value').then(s => {
                let lama = s.exists() ? parseInt(s.val().stok) : 0;
                let baru = (tipe === 'masuk') ? (lama + j) : (lama - j);

                if(baru < 0) return alert("Stok kurang!");

                sRef.update({ nama: n, stok: baru, update: w });
                rRef.set({ nama: n, jumlah: (tipe==='masuk'?'+':'-')+j, waktu: w, tipe: tipe });

                document.getElementById('nama').value = "";
                document.getElementById('jumlah').value = "";
                alert("Berhasil!");
            }).catch(e => alert("Error: " + e.message));
        }

        db.ref('stok').on('value', s => {
            let h = "";
            s.forEach(c => {
                h += <div class="flex justify-between border-b py-1"><span class="capitalize">${c.val().nama}</span><b>${c.val().stok} pcs</b></div>;
            });
            document.getElementById('tabelStok').innerHTML = h;
        });

        db.ref('riwayat').limitToLast(5).on('value', s => {
            let h = "";
            let data = [];
            s.forEach(c => { data.push(c.val()); });
            data.reverse().forEach(i => {
                h += <div class="border-b py-1">${i.waktu} - <span class="${i.tipe=='masuk'?'text-green-600':'text-red-600'}">${i.nama} (${i.jumlah})</span></div>;
            });
            document.getElementById('tabelRiwayat').innerHTML = h;
        });
    </script>
</body>
</html>