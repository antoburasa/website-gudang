<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Manajemen Stok Barang</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; }
    input, select, button { padding: 6px; margin: 4px; }
    table { border-collapse: collapse; width: 100%; margin-top: 15px; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
    th { background: #f0f0f0; }
  </style>
</head>
<body>

<h2>Manajemen Stok Barang</h2>

<h3>Tambah Barang</h3>
<input id="nama" placeholder="Nama Barang">
<input id="stok" type="number" placeholder="Stok Awal">
<button onclick="tambahBarang()">Tambah</button>

<h3>Transaksi</h3>
<select id="barang"></select>
<input id="jumlah" type="number" placeholder="Jumlah">
<select id="tipe">
  <option value="masuk">Barang Masuk</option>
  <option value="keluar">Barang Keluar</option>
</select>
<button onclick="transaksi()">Proses</button>

<h3>Data Stok</h3>
<table>
  <thead>
    <tr><th>Nama</th><th>Stok</th></tr>
  </thead>
  <tbody id="stokTable"></tbody>
</table>

<h3>Riwayat Transaksi</h3>
<table>
  <thead>
    <tr>
      <th>Tanggal</th>
      <th>Nama Barang</th>
      <th>Jumlah</th>
      <th>Tipe</th>
    </tr>
  </thead>
  <tbody id="transaksiTable"></tbody>
</table>

<script>
  // ðŸ”¥ GANTI SESUAI FIREBASE KAMU
  var firebaseConfig = {
    apiKey: "API_KEY",
    authDomain: "PROJECT_ID.firebaseapp.com",
    databaseURL: "https://PROJECT_ID.firebaseio.com",
    projectId: "PROJECT_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  function tambahBarang() {
    const nama = namaInput.value;
    const stok = parseInt(stokInput.value);
    db.ref("stok").push({ nama, stok });
    namaInput.value = stokInput.value = "";
  }

  function transaksi() {
    const id = barangSelect.value;
    const jumlah = parseInt(jumlahInput.value);
    const tipe = tipeSelect.value;

    db.ref("stok/" + id).once("value", snap => {
      let data = snap.val();
      let stokBaru = tipe === "masuk"
        ? data.stok + jumlah
        : data.stok - jumlah;

      if (stokBaru < 0) return alert("Stok tidak cukup!");

      db.ref("stok/" + id).update({ stok: stokBaru });

      db.ref("transaksi").push({
        nama: data.nama,
        jumlah,
        tipe,
        waktu: new Date().toLocaleString()
      });
    });
  }

  const namaInput = document.getElementById("nama");
  const stokInput = document.getElementById("stok");
  const barangSelect = document.getElementById("barang");
  const jumlahInput = document.getElementById("jumlah");
  const tipeSelect = document.getElementById("tipe");

  db.ref("stok").on("value", snap => {
    stokTable.innerHTML = "";
    barangSelect.innerHTML = "";
    snap.forEach(child => {
      let d = child.val();
      stokTable.innerHTML += <tr><td>${d.nama}</td><td>${d.stok}</td></tr>;
      barangSelect.innerHTML += <option value="${child.key}">${d.nama}</option>;
    });
  });

  db.ref("transaksi").on("value", snap => {
    transaksiTable.innerHTML = "";
    snap.forEach(child => {
      let t = child.val();
      transaksiTable.innerHTML += `
        <tr>
          <td>${t.waktu}</td>
          <td>${t.nama}</td>
          <td>${t.jumlah}</td>
          <td>${t.tipe}</td>
        </tr>`;
    });
  });
</script>

</body>
</html>
