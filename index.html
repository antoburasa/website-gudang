<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Gudang RawMaterial SMS</title>

<style>
body{font-family:Arial;background:#eef2f7;margin:0}
.menu{background:#1f2937;color:white;padding:10px}
.menu button{margin:4px;padding:8px}
.card{background:white;margin:10px;padding:15px;border-radius:8px}
table{border-collapse:collapse;width:100%}
th,td{border:1px solid #ccc;padding:6px}
input,select{padding:5px;margin:3px}
</style>
</head>

<body>

<div class="menu">
<button onclick="view('dash')">Dashboard</button>
<button onclick="view('master')">Master Barang</button>
<button onclick="view('masuk')">Barang Masuk</button>
<button onclick="view('keluar')">Barang Keluar</button>
<button onclick="view('prs')">PRS</button>
<button onclick="view('stok')">Stok</button>
<button onclick="view('log')">Riwayat</button>
</div>

<div id="app"></div>

<script>
let DB={
barang:JSON.parse(localStorage.getItem("barang")||"[]"),
transaksi:JSON.parse(localStorage.getItem("trx")||"[]"),
prs:JSON.parse(localStorage.getItem("prs")||"[]")
}

function save(){
localStorage.setItem("barang",JSON.stringify(DB.barang))
localStorage.setItem("trx",JSON.stringify(DB.transaksi))
localStorage.setItem("prs",JSON.stringify(DB.prs))
}

function view(v){
if(v=="dash")dashboard()
if(v=="master")master()
if(v=="masuk")masuk()
if(v=="keluar")keluar()
if(v=="stok")stok()
if(v=="log")log()
if(v=="prs")prs()
}

view("dash")

function dashboard(){
let total=DB.barang.length
document.getElementById("app").innerHTML=
`<div class="card">
<h2>Dashboard</h2>
Total Barang: ${total}
</div>`
}

function master(){
let html=`<div class="card">
<h3>Master Barang</h3>
Kode <input id="kode">
Nama <input id="nama">
UOM <input id="uom">
Gudang 
<select id="gudang">
<option>GS1</option>
<option>GS2</option>
<option>Gudang3</option>
<option>Ingredients</option>
</select>
<button onclick="addBarang()">Simpan</button>
</div>`

html+=`<div class="card"><table>
<tr><th>Kode</th><th>Nama</th><th>UOM</th><th>Gudang</th><th>Stok</th></tr>`

DB.barang.forEach(b=>{
html+=`<tr>
<td>${b.kode}</td>
<td>${b.nama}</td>
<td>${b.uom}</td>
<td>${b.gudang}</td>
<td>${b.stok||0}</td>
</tr>`
})

html+="</table></div>"
app.innerHTML=html
}

function addBarang(){
DB.barang.push({
kode:kode.value,
nama:nama.value,
uom:uom.value,
gudang:gudang.value,
stok:0
})
save()
master()
}

function masuk(){
let html=`<div class="card">
<h3>Barang Masuk</h3>
Barang <select id="bsel"></select>
Qty <input id="qty" type="number">
<button onclick="trxMasuk()">Simpan</button>
</div>`

app.innerHTML=html
isiBarang()
}

function keluar(){
let html=`<div class="card">
<h3>Barang Keluar</h3>
Barang <select id="bsel"></select>
Qty <input id="qty" type="number">
<button onclick="trxKeluar()">Simpan</button>
</div>`

app.innerHTML=html
isiBarang()
}

function isiBarang(){
let s=document.getElementById("bsel")
DB.barang.forEach(b=>{
let o=document.createElement("option")
o.value=b.kode
o.text=b.nama
s.appendChild(o)
})
}

function trxMasuk(){
let b=DB.barang.find(x=>x.kode==bsel.value)
b.stok+=parseInt(qty.value)

DB.transaksi.push({tipe:"Masuk",barang:b.nama,qty:qty.value,tanggal:new Date()})
save()
alert("Disimpan")
}

function trxKeluar(){
let b=DB.barang.find(x=>x.kode==bsel.value)
b.stok-=parseInt(qty.value)

DB.transaksi.push({tipe:"Keluar",barang:b.nama,qty:qty.value,tanggal:new Date()})
save()
alert("Disimpan")
}

function stok(){
let html=`<div class="card"><h3>Stok Barang</h3><table>
<tr><th>Nama</th><th>Gudang</th><th>Stok</th></tr>`
DB.barang.forEach(b=>{
html+=`<tr><td>${b.nama}</td><td>${b.gudang}</td><td>${b.stok}</td></tr>`
})
html+="</table></div>"
app.innerHTML=html
}

function log(){
let html=`<div class="card"><h3>Riwayat</h3><table>
<tr><th>Tanggal</th><th>Tipe</th><th>Barang</th><th>Qty</th></tr>`
DB.transaksi.forEach(t=>{
html+=`<tr>
<td>${new Date(t.tanggal).toLocaleString()}</td>
<td>${t.tipe}</td>
<td>${t.barang}</td>
<td>${t.qty}</td>
</tr>`
})
html+="</table></div>"
app.innerHTML=html
}

function prs(){
let no="PRS"+String(DB.prs.length+1).padStart(4,"0")
let html=`<div class="card">
<h3>Buat PRS</h3>
Nomor: ${no}<br>
Divisi <input id="div"><br>
<button onclick="savePRS('${no}')">Simpan PRS</button>
</div>`
app.innerHTML=html
}

function savePRS(no){
DB.prs.push({nomor:no,divisi:div.value})
save()
alert("PRS dibuat")
}
</script>

</body>
</html>
