<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Aplikasi Stok Barang</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<!-- XLSX -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
body { font-family: Arial; background:#f4f6f8; padding:20px }
input, button { padding:8px; margin:4px }
table { border-collapse: collapse; width:100%; background:white }
th, td { border:1px solid #ccc; padding:6px; text-align:center }
th { background:#eee }
.section { background:white; padding:15px; margin-bottom:20px; border-radius:6px }
</style>
</head>

<body>

<h2>ðŸ“¦ Aplikasi Stok Barang</h2>

<div class="section">
<h3>Tambah Barang</h3>
<input id="namaBarang" placeholder="Nama Barang">
<input id="stokBarang" type="number" placeholder="Stok Awal">
<button onclick="tambahBarang()">Tambah</button>
</div>

<div class="section">
<h3>Daftar Barang</h3>
<table>
<thead>
<tr>
<th>Nama</th>
<th>Stok</th>
<th>Masuk</th>
<th>Keluar</th>
<th>Aksi</th>
</tr>
</thead>
<tbody id="tabelBarang"></tbody>
</table>
</div>

<div class="section">
<h3>Riwayat Transaksi</h3>
<input type="date" id="filterTanggal">
<button onclick="loadRiwayat()">Filter</button>
<button onclick="exportExcel()">Export Excel</button>
<button onclick="printRiwayat()">Print</button>

<table>
<thead>
<tr>
<th>Tanggal</th>
<th>Barang</th>
<th>Jenis</th>
<th>Jumlah</th>
</tr>
</thead>
<tbody id="tabelRiwayat"></tbody>
</table>
</div>

<script>
// ðŸ”¥ GANTI DENGAN CONFIG FIREBASE KAMU
var firebaseConfig = {
  apiKey: "API_KEY",
  authDomain: "PROJECT_ID.firebaseapp.com",
  databaseURL: "https://PROJECT_ID.firebaseio.com",
  projectId: "PROJECT_ID",
  storageBucket: "PROJECT_ID.appspot.com",
  messagingSenderId: "SENDER_ID",
  appId: "APP_ID"
};
firebase.initializeApp(firebaseConfig);

const db = firebase.database();

// ================= TAMBAH BARANG =================
function tambahBarang() {
  const nama = namaBarang.value.trim();
  const stok = parseInt(stokBarang.value);

  if (nama === "" || isNaN(stok)) {
    alert("Isi nama & stok");
    return;
  }

  db.ref("barang").push({ nama, stok });
  namaBarang.value = "";
  stokBarang.value = "";
}

// ================= LOAD BARANG =================
db.ref("barang").on("value", snap => {
  tabelBarang.innerHTML = "";
  snap.forEach(item => {
    const b = item.val();
    tabelBarang.innerHTML += `
      <tr>
        <td>${b.nama}</td>
        <td>${b.stok}</td>
        <td><button onclick="transaksi('${item.key}', 'masuk')">+</button></td>
        <td><button onclick="transaksi('${item.key}', 'keluar')">-</button></td>
        <td>
          <button onclick="editBarang('${item.key}','${b.nama}',${b.stok})">Edit</button>
          <button onclick="hapusBarang('${item.key}')">Hapus</button>
        </td>
      </tr>`;
  });
});

// ================= TRANSAKSI =================
function transaksi(id, jenis) {
  let jumlah = parseInt(prompt("Jumlah:"));
  if (isNaN(jumlah) || jumlah <= 0) return;

  db.ref("barang/" + id).once("value", snap => {
    let data = snap.val();
    let stokBaru = jenis === "masuk"
      ? data.stok + jumlah
      : data.stok - jumlah;

    if (stokBaru < 0) {
      alert("Stok tidak cukup");
      return;
    }

    db.ref("barang/" + id).update({ stok: stokBaru });

    db.ref("riwayat").push({
      tanggal: new Date().toISOString().slice(0,10),
      barang: data.nama,
      jenis,
      jumlah
    });
  });
}

// ================= EDIT & HAPUS =================
function editBarang(id, nama, stok) {
  let n = prompt("Nama Barang:", nama);
  let s = parseInt(prompt("Stok:", stok));
  if (n && !isNaN(s)) {
    db.ref("barang/" + id).update({ nama:n, stok:s });
  }
}

function hapusBarang(id) {
  if (confirm("Hapus barang?")) {
    db.ref("barang/" + id).remove();
  }
}

// ================= RIWAYAT =================
function loadRiwayat() {
  const filter = filterTanggal.value;
  tabelRiwayat.innerHTML = "";

  db.ref("riwayat").once("value", snap => {
    snap.forEach(r => {
      let d = r.val();
      if (!filter || d.tanggal === filter) {
        tabelRiwayat.innerHTML += `
          <tr>
            <td>${d.tanggal}</td>
            <td>${d.barang}</td>
            <td>${d.jenis}</td>
            <td>${d.jumlah}</td>
          </tr>`;
      }
    });
  });
}
loadRiwayat();

// ================= EXPORT EXCEL =================
function exportExcel() {
  let wb = XLSX.utils.book_new();
  let ws = XLSX.utils.table_to_sheet(document.querySelector("#tabelRiwayat").parentNode);
  XLSX.utils.book_append_sheet(wb, ws, "Riwayat");
  XLSX.writeFile(wb, "riwayat_transaksi.xlsx");
}

// ================= PRINT =================
function printRiwayat() {
  window.print();
}
</script>

</body>
</html>
