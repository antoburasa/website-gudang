<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aplikasi Gudang</title>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
body{margin:0;font-family:Arial;background:#f4f6f8}
header{background:#0d6efd;color:#fff;padding:15px;text-align:center}
nav{display:flex;background:#fff;border-bottom:1px solid #ddd}
nav button{flex:1;padding:10px;border:none;background:#fff}
nav button.active{background:#0d6efd;color:#fff}
.container{padding:15px}
.card{background:#fff;padding:15px;border-radius:10px;margin-bottom:15px}
input,select,button{width:100%;padding:10px;margin-top:8px}
button.primary{background:#0d6efd;color:#fff;border:none}
button.danger{background:#dc3545;color:#fff;border:none}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ddd;padding:6px;font-size:14px;text-align:center}
th{background:#f1f1f1}
.hide{display:none}
</style>
</head>

<body>

<header>
  <h2>ðŸ“¦ Aplikasi Gudang</h2>
</header>

<nav>
  <button onclick="show('dash')" class="active">Dashboard</button>
  <button onclick="show('master')">Master</button>
  <button onclick="show('masuk')">Masuk</button>
  <button onclick="show('keluar')">Keluar</button>
  <button onclick="show('stok')">Stok</button>
  <button onclick="show('riwayat')">Riwayat</button>
</nav>

<div class="container">

<!-- DASHBOARD -->
<div id="dash" class="card">
  <h3>ðŸ“Š Dashboard</h3>
  <p>Total Barang: <b id="dBarang">0</b></p>
  <p>Total Stok: <b id="dStok">0</b></p>
  <p>Total Transaksi: <b id="dTrans">0</b></p>
</div>

<!-- MASTER -->
<div id="master" class="card hide">
  <h3>ðŸ“¦ Master Barang</h3>
  <input id="mbNama" placeholder="Nama Barang">
  <button class="primary" onclick="tambahBarang()">Tambah Barang</button>
  <table>
    <thead><tr><th>Barang</th><th>Aksi</th></tr></thead>
    <tbody id="listBarang"></tbody>
  </table>
</div>

<!-- BARANG MASUK -->
<div id="masuk" class="card hide">
  <h3>âž• Barang Masuk</h3>
  <select id="bmBarang"></select>
  <input id="bmJumlah" type="number" placeholder="Jumlah">
  <button class="primary" onclick="barangMasuk()">Simpan</button>
</div>

<!-- BARANG KELUAR -->
<div id="keluar" class="card hide">
  <h3>âž– Barang Keluar</h3>
  <select id="bkBarang"></select>
  <input id="bkJumlah" type="number" placeholder="Jumlah">
  <button class="danger" onclick="barangKeluar()">Simpan</button>
</div>

<!-- STOK -->
<div id="stok" class="card hide">
  <h3>ðŸ“¦ Stok Barang</h3>
  <table>
    <thead><tr><th>Barang</th><th>Stok</th></tr></thead>
    <tbody id="listStok"></tbody>
  </table>
</div>

<!-- RIWAYAT -->
<div id="riwayat" class="card hide">
  <h3>ðŸ§¾ Riwayat Transaksi</h3>
  <button onclick="exportExcel()">Export Excel</button>
  <table>
    <thead><tr><th>Barang</th><th>Jenis</th><th>Jumlah</th><th>Waktu</th><th>Aksi</th></tr></thead>
    <tbody id="listRiwayat"></tbody>
  </table>
</div>

</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
var firebaseConfig={
  apiKey:"AIzaSyDbf4Nf0J0ELJ3B3R8Un8Ypgi0io-TB30",
  authDomain:"gudang-sms-4c81c.firebaseapp.com",
  databaseURL:"https://gudang-sms-4c81c-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId:"gudang-sms-4c81c"
};
firebase.initializeApp(firebaseConfig);
var db=firebase.database();

function show(id){
  document.querySelectorAll('.container .card').forEach(c=>c.classList.add('hide'));
  document.getElementById(id).classList.remove('hide');
  document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
  event.target.classList.add('active');
}

/* MASTER BARANG */
function tambahBarang(){
  let n=mbNama.value.trim();
  if(!n)return;
  db.ref('barang/'+n).set({stok:0});
  mbNama.value="";
}
function hapusBarang(n){
  if(confirm("Hapus barang?")) db.ref('barang/'+n).remove();
}

/* BARANG MASUK */
function barangMasuk(){
  let b=bmBarang.value,j=Number(bmJumlah.value);
  if(!b||!j)return;
  db.ref('barang/'+b+'/stok').transaction(s=> (s||0)+j);
  db.ref('transaksi').push({barang:b,jenis:"Masuk",jumlah:j,waktu:new Date().toLocaleString()});
  bmJumlah.value="";
}

/* BARANG KELUAR */
function barangKeluar(){
  let b=bkBarang.value,j=Number(bkJumlah.value);
  db.ref('barang/'+b+'/stok').once('value',s=>{
    if(s.val()<j)return alert("Stok tidak cukup");
    db.ref('barang/'+b+'/stok').transaction(x=>x-j);
    db.ref('transaksi').push({barang:b,jenis:"Keluar",jumlah:j,waktu:new Date().toLocaleString()});
    bkJumlah.value="";
  });
}

/* LOAD */
db.ref('barang').on('value',s=>{
  let html="",opt="",stokHtml="",totalStok=0;
  let count=0;
  s.forEach(c=>{
    count++;
    let d=c.val(); totalStok+=d.stok;
    html+=<tr><td>${c.key}</td><td><button onclick="hapusBarang('${c.key}')">Hapus</button></td></tr>;
    opt+=<option>${c.key}</option>;
    stokHtml+=<tr><td>${c.key}</td><td>${d.stok}</td></tr>;
  });
  listBarang.innerHTML=html;
  bmBarang.innerHTML=bkBarang.innerHTML=opt;
  listStok.innerHTML=stokHtml;
  dBarang.innerText=count;
  dStok.innerText=totalStok;
});

db.ref('transaksi').on('value',s=>{
  let html="",arr=[],count=0;
  s.forEach(c=>{
    count++;
    let d=c.val();
    html+=`<tr><td>${d.barang}</td><td>${d.jenis}</td><td>${d.jumlah}</td><td>${d.waktu}</td>
    <td><button onclick="db.ref('transaksi/${c.key}').remove()">Hapus</button></td></tr>`;
    arr.push(d);
  });
  listRiwayat.innerHTML=html;
  dTrans.innerText=count;
  window.dataExcel=arr;
});

/* EXPORT */
function exportExcel(){
  let ws=XLSX.utils.json_to_sheet(window.dataExcel||[]);
  let wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,"Riwayat");
  XLSX.writeFile(wb,"laporan-gudang.xlsx");
}
</script>

</body>
</html>
