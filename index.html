<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Manajemen Stok Gudang</title>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://cdn.tailwindcss.com"></script>

</head>
<body class="bg-gray-100 p-6">

<h1 class="text-2xl font-bold mb-4">Manajemen Stok Barang</h1>

<!-- TAMBAH BARANG -->
<div class="bg-white p-4 rounded shadow mb-6">
  <h2 class="font-bold mb-2">Tambah Barang</h2>
  <input id="namaBarang" placeholder="Nama Barang" class="border p-2 w-full mb-2">
  <input id="stokBarang" type="number" placeholder="Stok Awal" class="border p-2 w-full mb-2">
  <button onclick="tambahBarang()" class="bg-blue-600 text-white px-4 py-2 rounded">
    Tambah
  </button>
</div>

<!-- TRANSAKSI -->
<div class="bg-white p-4 rounded shadow mb-6">
  <h2 class="font-bold mb-2">Transaksi</h2>

  <select id="pilihBarang" class="border p-2 w-full mb-2"></select>

  <input id="jumlahTransaksi" type="number" placeholder="Jumlah" class="border p-2 w-full mb-2">

  <div class="flex gap-2">
    <button onclick="transaksi('MASUK')" class="bg-green-600 text-white px-4 py-2 rounded w-full">
      Barang Masuk
    </button>
    <button onclick="transaksi('KELUAR')" class="bg-red-600 text-white px-4 py-2 rounded w-full">
      Barang Keluar
    </button>
  </div>
</div>

<!-- DATA STOK -->
<div class="bg-white p-4 rounded shadow mb-6">
  <h2 class="font-bold mb-2">Data Stok</h2>
  <table class="w-full border">
    <thead class="bg-gray-200">
      <tr>
        <th class="border p-2">Nama</th>
        <th class="border p-2">Stok</th>
      </tr>
    </thead>
    <tbody id="tabelStok"></tbody>
  </table>
</div>

<!-- RIWAYAT TRANSAKSI -->
<div class="bg-white p-4 rounded shadow">
  <h2 class="font-bold mb-2">Riwayat Transaksi</h2>
  <table class="w-full border">
    <thead class="bg-gray-200">
      <tr>
        <th class="border p-2">Tanggal</th>
        <th class="border p-2">Nama</th>
        <th class="border p-2">Jumlah</th>
        <th class="border p-2">Tipe</th>
      </tr>
    </thead>
    <tbody id="tabelRiwayat"></tbody>
  </table>
</div>

<script>
// ðŸ”¥ FIREBASE CONFIG (PUNYA KAMU)
firebase.initializeApp({
  apiKey: "AIzaSyDbf4nf0iQleiB3R8Un89Gpi1Oio-tTB3o",
  authDomain: "gudang-sms-4c81c.firebaseapp.com",
  databaseURL: "https://gudang-sms-4c81c-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "gudang-sms-4c81c"
});

const db = firebase.database();

// TAMBAH BARANG
function tambahBarang() {
  const nama = namaBarang.value.trim();
  const stok = parseInt(stokBarang.value);

  if (!nama || isNaN(stok)) {
    alert("Lengkapi data");
    return;
  }

  db.ref("stok").push({
    nama: nama,
    stok: stok
  });

  namaBarang.value = "";
  stokBarang.value = "";
}

// TRANSAKSI
function transaksi(tipe) {
  const key = pilihBarang.value;
  const jumlah = parseInt(jumlahTransaksi.value);

  if (!key || isNaN(jumlah)) {
    alert("Lengkapi transaksi");
    return;
  }

  const ref = db.ref("stok/" + key);

  ref.once("value").then(snap => {
    let stok = snap.val().stok;
    if (tipe === "KELUAR" && stok < jumlah) {
      alert("Stok tidak cukup");
      return;
    }

    const stokBaru = tipe === "MASUK" ? stok + jumlah : stok - jumlah;
    ref.update({ stok: stokBaru });

    db.ref("transaksi").push({
      tanggal: new Date().toLocaleString(),
      nama: snap.val().nama,
      jumlah: jumlah,
      tipe: tipe
    });

    jumlahTransaksi.value = "";
  });
}

// LOAD DATA
db.ref("stok").on("value", snap => {
  tabelStok.innerHTML = "";
  pilihBarang.innerHTML = "<option value=''>Pilih Barang</option>";

  snap.forEach(c => {
    const d = c.val();

    tabelStok.innerHTML += `
      <tr>
        <td class="border p-2">${d.nama}</td>
        <td class="border p-2">${d.stok}</td>
      </tr>`;

    pilihBarang.innerHTML += `
      <option value="${c.key}">${d.nama}</option>`;
  });
});

// RIWAYAT
db.ref("transaksi").limitToLast(50).on("value", snap => {
  tabelRiwayat.innerHTML = "";
  snap.forEach(c => {
    const d = c.val();
    tabelRiwayat.innerHTML =
      `<tr>
        <td class="border p-2">${d.tanggal}</td>
        <td class="border p-2">${d.nama}</td>
        <td class="border p-2">${d.jumlah}</td>
        <td class="border p-2">${d.tipe}</td>
      </tr>` + tabelRiwayat.innerHTML;
  });
});
</script>

</body>
</html>
