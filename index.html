<script>
  // 1. Inisialisasi Firebase (Data sudah benar)
  const firebaseConfig = {
    apiKey: "AIzaSyBsAfavpvnPq7suUIT5G3i2ntmtnuN1Sg",
    authDomain: "gudang-sms.firebaseapp.com",
    databaseURL: "https://gudang-sms-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "gudang-sms",
    storageBucket: "gudang-sms.firebasestorage.app",
    messagingSenderId: "646430339480",
    appId: "1:646430339480:web:a56f1ff3189a043e62bbed"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // 2. Fungsi Simpan (Sudah diperbaiki selector-nya)
  function simpanMasuk() {
    const nama = document.querySelector('input[placeholder="Cari Nama Barang"]').value;
    const jumlahInput = document.querySelector('input[type="number"]').value;

    if (nama && jumlahInput) {
      const stokRef = db.ref('stok/' + nama);
      stokRef.once('value').then((snapshot) => {
        let stokLama = (snapshot.val() && snapshot.val().stok) ? parseInt(snapshot.val().stok) : 0;
        let stokBaru = stokLama + parseInt(jumlahInput);
        
        stokRef.set({
          nama: nama,
          stok: stokBaru,
          waktu: new Date().toLocaleString()
        }).then(() => {
          alert("Data " + nama + " Berhasil Disimpan!");
          document.querySelector('input[type="number"]').value = ""; 
        });
      });
    } else {
      alert("Isi Nama Barang & Jumlah dulu!");
    }
  }

  // 3. Tampilkan ke Tabel (Sudah diperbaiki dari 'thody' ke 'tbody')
  db.ref('stok').on('value', (snapshot) => {
    const data = snapshot.val();
    const tabel = document.querySelector('table tbody'); 
    
    if (tabel) {
      tabel.innerHTML = "";
      for (let key in data) {
        tabel.innerHTML += `
          <tr>
            <td>-</td>
            <td>${data[key].nama}</td>
            <td>${data[key].stok}</td>
            <td>pcs</td>
          </tr>`;
      }
    }
  });
</script>